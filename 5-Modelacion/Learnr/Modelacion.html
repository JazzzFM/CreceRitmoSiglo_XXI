<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />



<meta name="progressive" content="false" />
<meta name="allow-skip" content="false" />

<title>Modelación de Datos</title>


<!-- highlightjs -->
<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>

<!-- taken from https://github.com/rstudio/rmarkdown/blob/67b7f5fc779e4cfdfd0f021d3d7745b6b6e17149/inst/rmd/h/default.html#L296-L362 -->
<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>
<!-- end tabsets -->



</head>

<body>



<div class="pageContent band">
<div class="bandContent page">

<div class="topics">

<style type="text/css">
  body{
  font-size: 13pt;
}
</style>
<p><img src="images/data-science-model.png" width="100%" /></p>
<div id="section-introducción" class="section level2">
<h2>Introducción</h2>
<p>Ahora que estás equipado con potentes herramientas de programación, finalmente podemos volver al modelado. Utilizarás sus nuevas herramientas de programación y gestión de datos para adaptarse a muchos modelos y comprender cómo funcionan.</p>
<p>El enfoque de este curso es la exploración, no la confirmación o la inferencia formal. Pero aprenderás algunas herramientas básicas que lo ayudarán a comprender la variación dentro de tus modelos.</p>
<p>El objetivo de un modelo es proporcionar un resumen simple de baja dimensión de un conjunto de datos. Idealmente, el modelo capturará verdaderas “señales” (es decir, patrones generados por el fenómeno de interés) e ignorará el “ruido” (es decir, la variación aleatoria que no le interesa).</p>
<p>Aquí solo cubrimos <strong>modelos predictivos</strong> que, como su nombre indica, generan predicciones. Hay otro tipo de modelo que no vamos a discutir: <strong>modelos de descubrimiento de datos</strong>. Estos modelos no hacen predicciones, sino que lo ayudan a descubrir relaciones interesantes dentro de los datos. (Estas dos categorías de modelos a veces se denominan supervisados y no supervisados, pero la terminología no es particularmente esclarecedora).</p>
<p>Desarrollarás una intuición sobre cómo funcionan los modelos estadísticos y le brindará una familia de herramientas útiles que le permitirán utilizar modelos para comprender mejor sus datos:</p>
<ul>
<li><p>En los <strong>conceptos básicos</strong> de modelación, aprenderás cómo funcionan los modelos de forma mecánica, centrándose en la importante familia de modelos lineales. Aprenderás herramientas generales para obtener información sobre lo que le dice un modelo predictivo sobre sus datos, centrándose en conjuntos de datos simulados simples.</p></li>
<li><p>En la <strong>construcción de modelos</strong>, aprenderás a usar modelos para extraer patrones conocidos en datos reales. Una vez que hayas reconocido un patrón importante, es útil hacerlo explícito en un modelo, porque entonces podrá ver más fácilmente las señales más sutiles que quedan.</p></li>
<li><p>En <strong>varios modelos</strong>, aprenderá a usar muchos modelos simples para ayudar a comprender conjuntos de datos complejos. Esta es una técnica poderosa, pero para acceder a ella, necesitará combinar herramientas de modelado y programación.</p></li>
</ul>
<p>Estos temas son notables por lo que no incluyen: ninguna herramienta para evaluar modelos cuantitativamente. Eso es deliberado: cuantificar con precisión un modelo requiere un par de grandes ideas que simplemente no tenemos el espacio para cubrir aquí.</p>
<p>Por ahora, dependerá de la evaluación cualitativa y de su escepticismo natural. En Obtener más información sobre los modelos, te indicaremos otros recursos en los que puede obtener más información.</p>
<div id="section-generación-de-hipótesis-vs-confirmación-de-hipótesis" class="section level3">
<h3>Generación de hipótesis vs confirmación de hipótesis</h3>
<p>En esta sección, vamos a utilizar modelos como herramienta de exploración, completando las herramientas para EDA que se presentaron anteriormente. No es así como se suelen enseñar los modelos, pero como verás, los modelos son una herramienta importante: herramienta de exploración.</p>
<p>Tradicionalmente, el enfoque del modelado está en la inferencia o para confirmar que una hipótesis es cierta. Hacer esto correctamente no es complicado, pero es difícil. Hay un par de ideas que debe comprender para hacer inferencias correctamente:</p>
<ul>
<li><p>Cada observación puede usarse para exploración o confirmación, no ambas.</p></li>
<li><p>Puedes utilizar una observación tantas veces como desees para la exploración, pero solo puede utilizarla una vez para la confirmación. Tan pronto como utilices una observación dos veces, pasará de la confirmación a la exploración.</p></li>
</ul>
<p>Esto es necesario porque para confirmar una hipótesis debe utilizar datos independientes de los datos que utilizaste para generar la hipótesis. De lo contrario, será demasiado optimista. No hay absolutamente nada de malo en la exploración, pero nunca debe vender un análisis exploratorio como un análisis confirmatorio porque es fundamentalmente engañoso.</p>
<p>Si realmente desea realizar un análisis confirmatorio, un enfoque es dividir sus datos en tres partes antes de comenzar el análisis:</p>
<ul>
<li><p>El 60% de sus datos va a un conjunto de entrenamiento (o exploración). Puede hacer lo que quiera con estos datos: visualizarlos y ajustar toneladas de modelos a ellos.</p></li>
<li><p>El 20% se destina a un conjunto de consultas. Puede utilizar estos datos para comparar modelos o visualizaciones a mano, pero no puede utilizarlos como parte de un proceso automatizado.</p></li>
<li><p>El 20% se retiene para una prueba. Solo puede usar estos datos UNA VEZ, para probar su modelo final.</p></li>
</ul>
<p>Esta partición le permite explorar los datos de entrenamiento, generando ocasionalmente hipótesis candidatas que verifica con el conjunto de consultas. Cuando esté seguro de que tiene el modelo correcto, puede verificarlo una vez con los datos de prueba.</p>
<p>(Tenga en cuenta que incluso cuando realice un modelo confirmatorio, deberá realizar una EDA. Si no realiza ninguna EDA, permanecerá ciego a los problemas de calidad con sus datos).</p>
</div>
</div>
<div id="section-conceptos-básicos-de-modelos" class="section level2">
<h2>Conceptos básicos de modelos</h2>
<div id="section-introducción-1" class="section level3">
<h3>Introducción</h3>
<p>El objetivo de un modelo es proporcionar un resumen simple de baja dimensión de un conjunto de datos. En el contexto de esta sección, usaremos modelos para dividir datos en patrones y residuos. Los patrones sólidos ocultarán tendencias más sutiles, por lo que usaremos modelos para ayudar a despegar capas de estructura a medida que exploramos un conjunto de datos.</p>
<p>Sin embargo, antes de que podamos comenzar a utilizar modelos en conjuntos de datos reales e interesantes, es necesario comprender los conceptos básicos de cómo funcionan los modelos. Por esa razón, esta sección solo usa conjuntos de datos simulados. Estos conjuntos de datos son muy simples y nada interesantes, pero lo ayudarán a comprender la esencia del modelado antes de aplicar las mismas técnicas a los datos reales.</p>
<p style="text-align:center">
Hay dos partes en un modelo.
</p>
<p><strong>Primero</strong> Define una familia de modelos que expresan un patrón preciso, pero genérico, que desea capturar.</p>
<p><strong>Por ejemplo</strong>: El patrón puede ser una línea recta o una curva cuadrática. Expresará la familia del modelo como una ecuación como <code>y = a_1 * x + a_2 o y = a_1 * x ^ a_2</code>. Aquí, <code>x</code> e <code>y</code> son variables conocidas de sus datos, y <code>a_1</code> y <code>a_2</code> son parámetros que pueden variar para capturar diferentes patrones.</p>
<p><strong>A continuación</strong>, genera un modelo ajustado encontrando el modelo de la familia más cercano a tus datos. Esto toma la familia de modelos genéricos y la hace específica, como <code>y = 3 * x + 7 o y = 9 * x ^ 2</code>.</p>
<p>Es importante comprender que un modelo ajustado es solo el modelo más cercano de una familia de modelos. Eso implica que tienes el “mejor” modelo (según algunos criterios); no implica que tenga un buen modelo y ciertamente no implica que el modelo sea “verdadero”. George Box lo expresa bien en su famoso aforismo:</p>
<pre><code>Todos los modelos son incorrectos, pero algunos son útiles.</code></pre>
<p>Vale la pena leer el contexto más completo de la cita:</p>
<pre><code>Ahora bien, sería muy notable si cualquier sistema existente en el mundo real pudiera ser representado exactamente por un modelo simple. Sin embargo, los modelos parsimoniosos elegidos astutamente a menudo proporcionan aproximaciones notablemente útiles. Por ejemplo, la ley PV = RT que relaciona la presión P, el volumen V y la temperatura T de un gas &quot;ideal&quot; a través de una constante R no es exactamente cierta para ningún gas real, pero con frecuencia proporciona una aproximación útil y, además, su estructura es informativa ya que surge de una visión física del comportamiento de las moléculas de gas.</code></pre>
<p>Para un modelo de este tipo, no es necesario plantearse la pregunta “¿Es el modelo verdadero?”. Si la “verdad” va a ser la “verdad total”, la respuesta debe ser “No”. La única pregunta de interés es “¿Es el modelo esclarecedor y útil?”.</p>
<p>El objetivo de un modelo no es descubrir la verdad, sino descubrir una aproximación simple que aún sea útil.</p>
</div>
<div id="section-requisitos-previos" class="section level3">
<h3>Requisitos previos</h3>
<p>En esta sección usaremos el paquete <code>modelr</code> que envuelve las funciones de modelado de la base R para que funcionen de forma natural en un <code>%&gt;%</code> <strong>pipe</strong></p>
<pre class="r"><code>library(tidyverse)

library(modelr)
options(na.action = na.warn)</code></pre>
</div>
<div id="section-un-modelo-simple" class="section level3">
<h3>Un modelo simple</h3>
<p>Echemos un vistazo al conjunto de datos simulado <code>sim1</code>, incluido con el paquete <code>modelr</code>. Contiene dos variables continuas, <code>x</code> e <code>y</code>. Vamos a trazarlos para ver cómo se relacionan:</p>
<pre class="r"><code>ggplot(sim1, aes(x, y)) +
   geom_point()</code></pre>
<p><img src="Modelacion_files/figure-html/simple-model-1-1.png" width="624" /></p>
<p>Puedes ver un patrón fuerte en los datos. Usemos un modelo para capturar ese patrón y hacerlo explícito. Nuestro trabajo es proporcionar la forma básica del modelo.</p>
<p>En este caso, la relación parece lineal, es decir, <code>y = a_0 + a_1 * x</code>.</p>
<p>Comencemos por tener una idea de cómo se ven los modelos de esa familia generando algunos al azar y superponiéndolos en los datos. Para este caso simple, podemos usar <code>geom_abline()</code> que toma una pendiente e intercepta como parámetros. Más adelante aprenderemos técnicas más generales que funcionan con cualquier modelo.</p>
<pre class="r"><code>models &lt;- tibble(
  a1 = runif(250, -20, 40),
  a2 = runif(250, -5, 5)
)

ggplot(sim1, aes(x, y)) + 
  geom_abline(aes(intercept = a1, slope = a2), data = models, alpha = 1/4) +
  geom_point() </code></pre>
<p><img src="Modelacion_files/figure-html/simple-model-2-1.png" width="624" /></p>
<p>Hay 250 modelos en esta trama, <strong>¡pero muchos son realmente malos!</strong> Necesitamos encontrar los buenos modelos haciendo precisa nuestra intuición de que un buen modelo está <strong>cerca</strong> de los datos.</p>
<p>Necesitamos una forma de cuantificar la distancia entre los datos y un modelo. Luego, podemos ajustar el modelo encontrando el valor de <code>a_0</code> y <code>a_1</code> que generan el modelo con la menor distancia de estos datos.</p>
<p>Un lugar fácil para comenzar es encontrar la distancia vertical entre cada punto y el modelo, como en el siguiente diagrama. (Ten en cuenta que he cambiado ligeramente los valores de <code>x</code> para que pueda ver las distancias individuales).</p>
<p><img src="images/unnamed-chunk-3-1.png" width="90%" /></p>
<p>Esta distancia es solo la diferencia entre el valor de y dado por el modelo (<strong>la predicción</strong>) y el valor de y real en los datos (<strong>la respuesta</strong>).</p>
<p>Para calcular esta distancia, primero convertimos nuestra familia de modelos en una función R. Esto toma los parámetros del modelo y los datos como entradas, y da los valores predichos por el modelo como salida:</p>
<pre class="r"><code>model1 &lt;- function(a, data) {
  a[1] + data$x * a[2]
}

model1(c(7, 1.5), sim1)</code></pre>
<pre><code>##  [1]  8.5  8.5  8.5 10.0 10.0 10.0 11.5 11.5 11.5 13.0 13.0 13.0 14.5 14.5 14.5
## [16] 16.0 16.0 16.0 17.5 17.5 17.5 19.0 19.0 19.0 20.5 20.5 20.5 22.0 22.0 22.0</code></pre>
<p>A continuación, necesitamos alguna forma de calcular una distancia total entre los valores predichos y reales. En otras palabras, la gráfica de arriba muestra 30 distancias: ¿cómo colapsamos eso en un solo número?</p>
<p>Una forma común de hacer esto en las estadísticas es utilizar la <strong>La desviación de la raíz cuadrática media o el error cuadrático medio</strong>. Calculamos la diferencia entre lo real y lo pronosticado, los cuadramos, los promediamos y sacamos la raíz cuadrada. Esta distancia tiene muchas propiedades matemáticas atractivas, de las que no vamos a hablar aquí. ¡Tendrás que creer en mi palabra!</p>
<pre class="r"><code>measure_distance &lt;- function(mod, data) {
  diff &lt;- data$y - model1(mod, data)
  sqrt(mean(diff ^ 2))
}

measure_distance(c(7, 1.5), sim1)</code></pre>
<pre><code>## [1] 2.665212</code></pre>
<p>Ahora podemos usar <code>purrr</code> para calcular la distancia para todos los modelos definidos anteriormente. Necesitamos una función auxiliar porque nuestra función de distancia espera el modelo como un vector numérico de longitud 2.</p>
<pre class="r"><code>library(purrr)
sim1_dist &lt;- function(a1, a2) {
  measure_distance(c(a1, a2), sim1)
}

models &lt;- models %&gt;% 
  mutate(dist = purrr::map2_dbl(a1, a2, sim1_dist))
models</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["a1"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["a2"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["dist"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"-2.00759192","2":"2.197549015","3":"5.842877"},{"1":"0.26823677","2":"-4.520007949","3":"44.367789"},{"1":"-19.99412779","2":"1.206778705","3":"29.040996"},{"1":"-3.82589797","2":"-1.773743492","3":"31.164557"},{"1":"37.60270707","2":"1.127649003","3":"28.504221"},{"1":"21.20993589","2":"-2.915617246","3":"17.742358"},{"1":"23.58976058","2":"0.434344749","3":"11.654118"},{"1":"-11.45676893","2":"-4.514187083","3":"55.156882"},{"1":"33.03211289","2":"-0.044313713","3":"18.425774"},{"1":"-11.83932150","2":"-0.885795006","3":"33.369812"},{"1":"16.79296930","2":"-3.651572678","3":"25.022258"},{"1":"-5.58712487","2":"2.470663209","3":"7.891097"},{"1":"-13.16926439","2":"-1.984465637","3":"41.305348"},{"1":"37.72004479","2":"-0.950963129","3":"19.167936"},{"1":"-4.40147794","2":"-4.680543775","3":"49.620884"},{"1":"24.19648383","2":"1.912376662","3":"19.331958"},{"1":"2.69468092","2":"-0.371460931","3":"16.539772"},{"1":"0.27395033","2":"-2.669230709","3":"32.909842"},{"1":"17.67179860","2":"-1.382163179","3":"11.459977"},{"1":"38.35807139","2":"4.470963210","3":"47.997560"},{"1":"37.25169018","2":"-0.942142576","3":"18.785294"},{"1":"39.42071868","2":"2.932708547","3":"40.182660"},{"1":"1.34157156","2":"-2.820903326","3":"32.880881"},{"1":"-7.62317741","2":"1.551272501","3":"14.819597"},{"1":"-0.37768026","2":"-0.720044014","3":"21.485219"},{"1":"10.97934796","2":"4.212353604","3":"19.763919"},{"1":"29.67667297","2":"0.277231564","3":"16.640409"},{"1":"23.98362496","2":"-0.945305822","3":"9.454227"},{"1":"9.79457081","2":"1.906062011","3":"5.243238"},{"1":"13.79171922","2":"0.532962100","3":"5.003948"},{"1":"13.64878155","2":"4.785531575","3":"25.782352"},{"1":"13.55921039","2":"-3.201752293","3":"24.790926"},{"1":"11.84706877","2":"2.223661847","3":"8.846985"},{"1":"-10.10974735","2":"2.049429093","3":"14.499179"},{"1":"15.35661398","2":"3.459995924","3":"19.427761"},{"1":"24.78054053","2":"1.947709604","3":"20.103875"},{"1":"21.52817479","2":"-3.979089325","3":"23.582664"},{"1":"4.59596785","2":"-1.752569545","3":"23.369059"},{"1":"19.74044272","2":"-2.728123653","3":"17.577309"},{"1":"36.25138736","2":"1.727918850","3":"30.339697"},{"1":"30.99019124","2":"-0.973273851","3":"13.516230"},{"1":"5.20651061","2":"3.618337221","3":"10.816729"},{"1":"-12.28941009","2":"-3.550615998","3":"50.028236"},{"1":"-12.69859278","2":"1.110013630","3":"22.364122"},{"1":"8.62252120","2":"0.838930083","3":"4.669271"},{"1":"20.78729089","2":"-3.804372179","3":"23.066778"},{"1":"-10.93832113","2":"1.553456283","3":"18.081329"},{"1":"34.99317715","2":"-4.877926593","3":"21.320028"},{"1":"33.66172876","2":"4.183063728","3":"41.671502"},{"1":"10.19092076","2":"-3.538363096","3":"29.598713"},{"1":"24.77574245","2":"3.897040647","3":"31.232001"},{"1":"7.93305945","2":"-1.286790974","3":"17.636620"},{"1":"-4.20810661","2":"4.942119035","3":"11.368917"},{"1":"22.29738538","2":"-1.170764207","3":"9.503463"},{"1":"-19.34328275","2":"-3.507525653","3":"56.484542"},{"1":"7.36486407","2":"-0.720007478","3":"14.638895"},{"1":"-15.67828468","2":"-0.030000440","3":"31.983479"},{"1":"-1.73415260","2":"4.467500546","3":"10.317665"},{"1":"7.24396275","2":"-3.388869027","3":"31.181284"},{"1":"-3.56378864","2":"-1.205382587","3":"27.430094"},{"1":"30.69422569","2":"-4.111341988","3":"19.312297"},{"1":"22.71169883","2":"-4.184354099","3":"23.983047"},{"1":"27.25040100","2":"2.246158160","3":"24.200258"},{"1":"28.55993627","2":"2.236546790","3":"25.451390"},{"1":"0.40003167","2":"0.275739303","3":"14.668656"},{"1":"38.79699727","2":"-0.253657063","3":"22.975531"},{"1":"20.39605400","2":"1.839515038","3":"15.171489"},{"1":"22.77852379","2":"1.778005017","3":"17.203527"},{"1":"-18.77237361","2":"3.081855045","3":"17.705707"},{"1":"5.45186437","2":"1.891454007","3":"2.205332"},{"1":"28.16621904","2":"1.726615231","3":"22.279869"},{"1":"26.83274983","2":"-3.472844868","3":"17.796494"},{"1":"29.91447219","2":"4.923800707","3":"42.356868"},{"1":"-14.57855839","2":"-1.487598862","3":"39.649013"},{"1":"-0.69005193","2":"2.051052265","3":"5.354607"},{"1":"16.23858726","2":"-2.835345552","3":"20.551735"},{"1":"15.24063073","2":"-2.642298443","3":"20.130153"},{"1":"-7.84952878","2":"-2.693662927","3":"40.585226"},{"1":"13.85758456","2":"4.151646232","3":"22.131897"},{"1":"32.33650623","2":"-3.989228220","3":"18.211947"},{"1":"22.49850672","2":"-2.999255082","3":"17.472029"},{"1":"10.11357324","2":"-4.655331597","3":"36.555728"},{"1":"27.11871342","2":"-3.119987922","3":"15.997644"},{"1":"21.53195582","2":"2.082260593","3":"17.609431"},{"1":"17.24308536","2":"-1.772830226","3":"13.761523"},{"1":"-12.62964188","2":"-4.238795759","3":"54.569121"},{"1":"-17.98003275","2":"-3.206029069","3":"53.343872"},{"1":"-15.78860652","2":"2.757746270","3":"16.391083"},{"1":"-4.85531898","2":"0.717850069","3":"16.986391"},{"1":"-5.81970677","2":"4.988607957","3":"10.633460"},{"1":"37.77008274","2":"-4.541028920","3":"19.246631"},{"1":"14.13766521","2":"-4.058866587","3":"29.559976"},{"1":"10.19075046","2":"-4.599560290","3":"36.145861"},{"1":"34.72195783","2":"3.453110843","3":"38.480196"},{"1":"-9.85009044","2":"2.156266661","3":"13.664969"},{"1":"-2.56392064","2":"-3.093632045","3":"38.128160"},{"1":"27.57867122","2":"2.765354963","3":"27.443440"},{"1":"36.59632917","2":"-0.321359341","3":"20.601502"},{"1":"14.19363294","2":"-2.391440857","3":"19.405629"},{"1":"-14.37324923","2":"1.416209340","3":"22.265544"},{"1":"39.87480773","2":"0.214801708","3":"26.177548"},{"1":"22.37493067","2":"-0.671801639","3":"8.706389"},{"1":"23.68095184","2":"4.294898610","3":"32.514648"},{"1":"-15.85737165","2":"-0.027948264","3":"32.146864"},{"1":"25.17061811","2":"-0.518006710","3":"10.270152"},{"1":"1.08690172","2":"-4.533655900","3":"43.713889"},{"1":"31.38434114","2":"3.288454597","3":"34.218131"},{"1":"-0.39587228","2":"-2.257831052","3":"30.978332"},{"1":"17.80201240","2":"-1.969741033","3":"14.518855"},{"1":"2.16614018","2":"4.514300027","3":"13.660148"},{"1":"-12.18277374","2":"3.677477569","3":"9.055644"},{"1":"16.30032206","2":"2.330050482","3":"13.799922"},{"1":"-5.70126493","2":"3.003862158","3":"5.826987"},{"1":"-18.85037208","2":"2.711334901","3":"19.650015"},{"1":"32.49910188","2":"2.360989654","3":"30.068872"},{"1":"36.90452395","2":"-3.055356224","3":"15.518159"},{"1":"-13.62023768","2":"-1.964635833","3":"41.617334"},{"1":"14.47843315","2":"-3.881302287","3":"28.204033"},{"1":"18.41308096","2":"0.928677123","3":"8.899207"},{"1":"20.86527126","2":"-3.460900099","3":"21.028497"},{"1":"9.61589613","2":"-2.158413131","3":"21.590593"},{"1":"15.44251975","2":"-2.314412410","3":"18.038739"},{"1":"-10.81823894","2":"3.264847035","3":"9.309211"},{"1":"5.23747604","2":"-2.358967648","3":"26.554870"},{"1":"27.73412584","2":"-3.831718296","3":"19.191406"},{"1":"-8.74260839","2":"0.116037012","3":"24.347559"},{"1":"21.24791317","2":"-2.105929637","3":"13.461784"},{"1":"10.97478965","2":"2.176060467","3":"7.745570"},{"1":"-4.81689946","2":"4.946569898","3":"11.003515"},{"1":"36.21432771","2":"-1.198441894","3":"17.058855"},{"1":"14.97229378","2":"-3.176790203","3":"23.541473"},{"1":"15.92929341","2":"-1.641696026","3":"13.823619"},{"1":"-2.96000367","2":"1.275213391","3":"11.858207"},{"1":"39.92918822","2":"-4.100401010","3":"17.896038"},{"1":"-12.60693740","2":"4.799086684","3":"8.351899"},{"1":"-6.07236076","2":"1.789523736","3":"11.949383"},{"1":"38.31732805","2":"-0.494632837","3":"21.487808"},{"1":"-7.25229345","2":"0.932700762","3":"18.043190"},{"1":"-1.81899478","2":"-2.266469926","3":"32.337690"},{"1":"-12.08142012","2":"-3.319560802","3":"48.416266"},{"1":"8.24583863","2":"-0.818816512","3":"14.520419"},{"1":"1.92150172","2":"-3.790869685","3":"38.363152"},{"1":"22.33713123","2":"-4.938211387","3":"28.649503"},{"1":"13.35528845","2":"3.801426229","3":"19.536817"},{"1":"6.58572983","2":"1.435697069","3":"2.950063"},{"1":"-0.11258360","2":"0.978398179","3":"10.899472"},{"1":"8.11773134","2":"2.611524635","3":"7.469464"},{"1":"38.14523759","2":"-1.450716881","3":"17.908017"},{"1":"17.45203562","2":"3.884023901","3":"23.991350"},{"1":"12.79599901","2":"-3.362378012","3":"26.378718"},{"1":"33.33571712","2":"2.517544341","3":"31.777567"},{"1":"1.09924349","2":"-2.401091398","3":"30.503452"},{"1":"2.28132817","2":"0.032541999","3":"14.432717"},{"1":"21.82774360","2":"-0.797580210","3":"8.674634"},{"1":"10.33726395","2":"0.387598122","3":"6.048405"},{"1":"34.15653799","2":"2.709147732","3":"33.673041"},{"1":"24.59278975","2":"-2.862161330","3":"15.747618"},{"1":"-15.66810407","2":"-2.139378625","3":"44.645074"},{"1":"5.11927463","2":"0.250829100","3":"10.600832"},{"1":"35.64116383","2":"0.194366404","3":"21.969871"},{"1":"30.74321129","2":"-0.001369838","3":"16.471014"},{"1":"-2.35632776","2":"-3.190107748","3":"38.533017"},{"1":"-14.80092176","2":"0.201097969","3":"29.755128"},{"1":"28.48271325","2":"-0.237607076","3":"13.564189"},{"1":"32.15269410","2":"4.447557044","3":"41.736366"},{"1":"24.33561895","2":"2.003972062","3":"19.967419"},{"1":"34.13283464","2":"-2.171438194","3":"14.012623"},{"1":"17.02097365","2":"2.053779215","3":"12.988052"},{"1":"25.69793568","2":"-0.700824405","3":"10.354303"},{"1":"19.69952282","2":"-4.501978327","3":"27.960665"},{"1":"-1.55071415","2":"-3.511831469","3":"39.782597"},{"1":"21.05613000","2":"-3.183438703","3":"19.328491"},{"1":"6.05499437","2":"-2.054462093","3":"23.961016"},{"1":"-2.72747923","2":"2.685508078","3":"4.452705"},{"1":"27.06099636","2":"-4.581147654","3":"23.526682"},{"1":"36.21336786","2":"0.647696271","3":"24.695969"},{"1":"-12.32794191","2":"1.367637815","3":"20.515641"},{"1":"1.79127599","2":"1.786960324","3":"4.494164"},{"1":"-9.89132685","2":"1.498660762","3":"17.357260"},{"1":"0.38222615","2":"-2.168040283","3":"29.713942"},{"1":"16.38894691","2":"-4.216125866","3":"28.741726"},{"1":"14.79698382","2":"4.852933697","3":"27.284339"},{"1":"18.84815251","2":"-3.714657319","3":"23.891189"},{"1":"-8.12716275","2":"-0.420085844","3":"26.979792"},{"1":"4.30430787","2":"1.446911977","3":"4.249140"},{"1":"-10.52446709","2":"0.534387981","3":"23.593377"},{"1":"35.30678199","2":"-4.835810240","3":"21.024659"},{"1":"31.75630078","2":"1.886108804","3":"26.714788"},{"1":"30.48882032","2":"2.165133490","3":"26.978850"},{"1":"-11.88143316","2":"2.591983003","3":"13.391415"},{"1":"-1.13224801","2":"4.390778448","3":"10.301242"},{"1":"-7.59033025","2":"1.609535564","3":"14.456120"},{"1":"14.63781864","2":"-4.715247105","3":"33.174490"},{"1":"-14.68039174","2":"3.663489732","3":"11.255056"},{"1":"-4.67196513","2":"0.159890787","3":"20.159798"},{"1":"-5.18204767","2":"1.758693338","3":"11.248713"},{"1":"1.54051814","2":"-2.319619344","3":"29.600808"},{"1":"25.11084581","2":"0.208133082","3":"12.171879"},{"1":"-3.63132284","2":"1.767825710","3":"9.684473"},{"1":"14.71217582","2":"4.969289582","3":"27.912062"},{"1":"-11.73771388","2":"-4.947646395","3":"58.085497"},{"1":"19.19226556","2":"3.982640610","3":"26.273041"},{"1":"18.65586688","2":"0.486223192","3":"7.660527"},{"1":"3.18051064","2":"0.218397190","3":"12.488541"},{"1":"-4.87041161","2":"0.011358089","3":"21.247436"},{"1":"-14.43033848","2":"-3.039922293","3":"48.938781"},{"1":"17.74514220","2":"-1.975043388","3":"14.581678"},{"1":"34.25244329","2":"-4.926568435","3":"21.816092"},{"1":"16.12509212","2":"-4.054925886","3":"27.968534"},{"1":"20.85836945","2":"4.286088643","3":"29.707400"},{"1":"24.67175387","2":"-4.742893458","3":"25.915571"},{"1":"12.34452324","2":"-2.663820228","3":"22.476360"},{"1":"-1.79813706","2":"-3.993954142","3":"42.989705"},{"1":"8.09439066","2":"2.290461464","3":"5.649079"},{"1":"15.19335783","2":"1.042882157","3":"6.507892"},{"1":"-11.98186128","2":"0.914067710","3":"22.794700"},{"1":"1.76053410","2":"-3.226250398","3":"35.011900"},{"1":"-4.05233506","2":"-4.259882572","3":"46.700650"},{"1":"9.73005874","2":"-3.843669258","3":"31.868926"},{"1":"39.50497880","2":"0.772421942","3":"28.566340"},{"1":"-8.73900454","2":"2.820104216","3":"9.255389"},{"1":"-14.72200998","2":"0.155338298","3":"29.948308"},{"1":"21.14412567","2":"-1.458744945","3":"10.576665"},{"1":"20.29277913","2":"2.915014357","3":"21.076023"},{"1":"4.64944446","2":"-3.645144582","3":"35.032287"},{"1":"-13.55903718","2":"3.232225322","3":"11.975178"},{"1":"8.99308637","2":"3.052165010","3":"10.880277"},{"1":"34.00715238","2":"-0.291038025","3":"18.316282"},{"1":"24.87652381","2":"-0.025603063","3":"11.195689"},{"1":"5.53282219","2":"-0.686850289","3":"15.982233"},{"1":"-1.92727778","2":"2.542612441","3":"4.289714"},{"1":"0.07934165","2":"-1.990393708","3":"28.892859"},{"1":"28.38029732","2":"-3.579694829","3":"17.679078"},{"1":"37.95231835","2":"-1.213908282","3":"18.472741"},{"1":"-7.91635782","2":"0.885978483","3":"18.967214"},{"1":"-15.26130029","2":"-0.809403914","3":"36.225841"},{"1":"-7.42454479","2":"-2.231070045","3":"37.347792"},{"1":"-15.21048034","2":"0.180177123","3":"30.280726"},{"1":"8.87120699","2":"-1.365960555","3":"17.348993"},{"1":"-18.41962215","2":"0.825439473","3":"29.670667"},{"1":"31.48425172","2":"1.300616064","3":"23.330981"},{"1":"-8.35120859","2":"-4.260571636","3":"50.689678"},{"1":"13.30942234","2":"4.032580520","3":"20.887350"},{"1":"-16.63884110","2":"0.402358617","3":"30.377287"},{"1":"30.49912483","2":"-3.483644575","3":"16.572354"},{"1":"27.83235854","2":"-4.288687163","3":"21.516184"},{"1":"11.93821465","2":"4.710412801","3":"23.706208"},{"1":"-16.74097485","2":"-3.497770547","3":"53.935905"},{"1":"27.19088240","2":"3.125056413","3":"29.116492"},{"1":"25.42733743","2":"2.190490207","3":"22.077219"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>A continuación, superpongamos los 10 mejores modelos a los datos. Hemos coloreado los modelos por <code>-dist</code>: esta es una manera fácil de asegurarse de que los mejores modelos (es decir, los que tienen la distancia más pequeña) obtengan los colores más brillantes.</p>
<pre class="r"><code>ggplot(sim1, aes(x, y)) + 
  geom_point(size = 2, colour = &quot;grey30&quot;) + 
  geom_abline(
    aes(intercept = a1, slope = a2, colour = -dist), 
    data = filter(models, rank(dist) &lt;= 10)
  )</code></pre>
<p><img src="Modelacion_files/figure-html/simple-model-6-1.png" width="624" /></p>
<p>También podemos pensar en estos modelos como observaciones, y visualizar con una gráfica de dispersión de <code>a1</code> vs <code>a2</code>, nuevamente coloreado por <code>-dist</code>. Ya no podemos ver directamente cómo se compara el modelo con los datos, pero podemos ver muchos modelos a la vez. Nuevamente, he resaltado los 10 mejores modelos, esta vez dibujando círculos rojos debajo de ellos.</p>
<pre class="r"><code>ggplot(models, aes(a1, a2)) +
  geom_point(data = filter(models, rank(dist) &lt;= 10), size = 4, colour = &quot;red&quot;) +
  geom_point(aes(colour = -dist))</code></pre>
<p><img src="Modelacion_files/figure-html/simple-model-7-1.png" width="624" /></p>
<p>En lugar de probar muchos modelos aleatorios, podríamos ser más sistemáticos y generar una cuadrícula de puntos espaciados uniformemente (esto se llama búsqueda de cuadrícula). Elegí los parámetros de la cuadrícula aproximadamente al observar dónde estaban los mejores modelos en el gráfico de arriba.</p>
<pre class="r"><code>grid &lt;- expand.grid(
  a1 = seq(-5, 20, length = 25),
  a2 = seq(1, 3, length = 25)
  ) %&gt;% 
  mutate(dist = purrr::map2_dbl(a1, a2, sim1_dist))

grid %&gt;% 
  ggplot(aes(a1, a2)) +
  geom_point(data = filter(grid, rank(dist) &lt;= 10), size = 4, colour = &quot;red&quot;) +
  geom_point(aes(colour = -dist))</code></pre>
<p><img src="Modelacion_files/figure-html/simple-model-8-1.png" width="624" /></p>
<p>Cuando superpone los 10 mejores modelos sobre los datos originales, todos se ven bastante bien:</p>
<pre class="r"><code>ggplot(sim1, aes(x, y)) + 
  geom_point(size = 2, colour = &quot;grey30&quot;) + 
  geom_abline(
    aes(intercept = a1, slope = a2, colour = -dist), 
    data = filter(grid, rank(dist) &lt;= 10)
  )</code></pre>
<p><img src="Modelacion_files/figure-html/simple-model-9-1.png" width="624" /></p>
<p>Podrías imaginarte haciendo iterativamente la cuadrícula cada vez más fina hasta que te acercaras al mejor modelo. Pero hay una mejor manera de abordar ese problema:</p>
<ul>
<li>Una herramienta de minimización numérica llamada búsqueda de <strong>Newton-Raphson</strong>.</li>
</ul>
<p>La intuición de <strong>Newton-Raphson</strong> es bastante simple: eliges un punto de partida y miras a tu alrededor en busca de la pendiente más empinada. A continuación, esquías por esa pendiente un poco y luego repites una y otra vez, hasta que no puedas bajar más. En R, podemos hacer eso con <code>optim()</code>:</p>
<pre class="r"><code>best &lt;- optim(c(0, 0), measure_distance, data = sim1)
best$par</code></pre>
<pre><code>## [1] 4.222248 2.051204</code></pre>
<pre class="r"><code>ggplot(sim1, aes(x, y)) + 
  geom_point(size = 2, colour = &quot;grey30&quot;) + 
  geom_abline(intercept = best$par[1], slope = best$par[2])</code></pre>
<p><img src="Modelacion_files/figure-html/simple-model-10-1.png" width="624" /></p>
<p>No se te preocupes demasiado por los detalles de cómo funciona <code>optim()</code>. Es la intuición lo que es importante aquí. Si tiene una función que define la distancia entre un modelo y un conjunto de datos, un algoritmo que puede minimizar esa distancia modificando los parámetros del modelo, puede encontrar el mejor modelo. Lo bueno de este enfoque es que funcionará para cualquier familia de modelos para los que pueda escribir una ecuación.</p>
<p>Hay un enfoque más que podemos utilizar para este modelo, porque es un caso especial de una familia más amplia: los modelos lineales.</p>
<p>Un modelo lineal tiene la forma general <code>y = a_1 + a_2 * x_1 + a_3 * x_2 + ... + a_n * x_ (n - 1)</code>.</p>
<p>Entonces, este modelo simple es equivalente a un modelo lineal general donde <code>n</code> es <code>2</code> y <code>x_1</code> es <code>x</code>.</p>
<p>R tiene una herramienta diseñada específicamente para ajustar modelos lineales llamada <code>lm()</code>. <code>lm()</code> tiene una forma especial de especificar la familia de modelos: fórmulas. Las fórmulas se ven como <code>y ~ x</code>, que <code>lm()</code> se traducirá en una función como <code>y = a_1 + a_2 * x</code>.</p>
<p>Podemos ajustar el modelo y mirar el resultado:</p>
<pre class="r"><code>sim1_mod &lt;- lm(y ~ x, data = sim1)
coef(sim1_mod)</code></pre>
<pre><code>## (Intercept)           x 
##    4.220822    2.051533</code></pre>
<p>¡Estos son exactamente los mismos valores que obtuvimos con <code>optim()</code>!</p>
<p>Detrás de escena <code>lm()</code> no usa <code>optim()</code> sino que aprovecha la estructura matemática de los modelos lineales. Usando algunas conexiones entre geometría, cálculo y álgebra lineal, <code>lm()</code> en realidad encuentra el modelo más cercano en un solo paso, usando un algoritmo sofisticado. Este enfoque es más rápido y garantiza que existe un mínimo global.</p>
</div>
<div id="section-ejercicios" class="section level3">
<h3>Ejercicios</h3>
<p>1 - Una desventaja del modelo lineal es que es sensible a valores inusuales porque la distancia incorpora un término al cuadrado. Ajusta un modelo lineal a los datos simulados a continuación y visualiza los resultados. Vuelva a ejecutar varias veces para generar diferentes conjuntos de datos simulados. ¿Qué notas sobre el modelo?</p>
<pre class="r"><code>sim1a &lt;- tibble(
  x = rep(1:10, each = 3),
  y = x * 1.5 + 6 + rt(length(x), df = 2)
)</code></pre>
<p>2 - Una forma de hacer que los modelos lineales sean más robustos es utilizar una medida de distancia diferente. Por ejemplo, en lugar de la distancia de la raíz cuadrada media, puede usar la distancia media absoluta:</p>
<pre class="r"><code>measure_distance &lt;- function(mod, data) {
  diff &lt;- data$y - model1(mod, data)
  mean(abs(diff))
}</code></pre>
<p>Utiliza <code>optim()</code> para ajustar este modelo a los datos simulados anteriores y compárelo con el modelo lineal.</p>
<p>3 - Un desafío al realizar la optimización numérica es que solo está garantizado encontrar un óptimo local. ¿Cuál es el problema de optimizar un modelo de tres parámetros como este?</p>
<pre class="r"><code>model1 &lt;- function(a, data) {
  a[1] + data$x * a[2] + a[3]
}</code></pre>
</div>
</div>
<div id="section-visualización-de-modelos" class="section level2">
<h2>Visualización de modelos</h2>
<p>Para modelos simples, como el anterior, puede averiguar qué patrón captura el modelo estudiando cuidadosamente la familia del modelo y los coeficientes ajustados. Y si alguna vez tomas un curso de estadística sobre modelado, es probable que dediques mucho tiempo a hacerlo.</p>
<p>Aquí, sin embargo, vamos a tomar un rumbo diferente. Nos centraremos en comprender un modelo observando sus predicciones. Esto tiene una gran ventaja: cada tipo de modelo predictivo hace predicciones (de lo contrario, ¿de qué serviría?), Por lo que podemos usar el mismo conjunto de técnicas para comprender cualquier tipo de modelo predictivo.</p>
<p>También es útil ver lo que el modelo no captura, los llamados residuos que quedan después de restar las predicciones de los datos. Los residuos son poderosos porque nos permiten utilizar modelos para eliminar patrones llamativos y poder estudiar las tendencias más sutiles que quedan.</p>
<div id="section-predicciones" class="section level3">
<h3>Predicciones</h3>
<p>Para visualizar las predicciones de un modelo, comenzamos generando una cuadrícula de valores espaciados uniformemente que cubre la región donde se encuentran nuestros datos. La forma más sencilla de hacerlo es usar <code>modelr::data_grid()</code>. Su primer argumento es un marco de datos, y para cada argumento subsiguiente encuentra las variables únicas y luego genera todas las combinaciones:</p>
<pre class="r"><code>grid &lt;- sim1 %&gt;% 
  data_grid(x) 
grid</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["x"],"name":[1],"type":["int"],"align":["right"]}],"data":[{"1":"1"},{"1":"2"},{"1":"3"},{"1":"4"},{"1":"5"},{"1":"6"},{"1":"7"},{"1":"8"},{"1":"9"},{"1":"10"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>(Esto se volverá más interesante cuando comencemos a agregar más variables a nuestro modelo).</p>
<p>A continuación, agregamos predicciones. Usaremos <code>modelr::add_predictions()</code> que toma un dataframe y un modelo. Agrega las predicciones del modelo a una nueva columna en el marco de datos:</p>
<pre class="r"><code>grid &lt;- grid %&gt;% 
  add_predictions(sim1_mod) 
grid</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["x"],"name":[1],"type":["int"],"align":["right"]},{"label":["pred"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"6.272355"},{"1":"2","2":"8.323888"},{"1":"3","2":"10.375421"},{"1":"4","2":"12.426954"},{"1":"5","2":"14.478487"},{"1":"6","2":"16.530020"},{"1":"7","2":"18.581553"},{"1":"8","2":"20.633087"},{"1":"9","2":"22.684620"},{"1":"10","2":"24.736153"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>(También puedes usar esta función para agregar predicciones a su conjunto de datos original).</p>
<p>A continuación, graficamos las predicciones. Quizás se pregunte acerca de todo este trabajo adicional en comparación con solo usar <code>geom_abline()</code>. Pero la ventaja de este enfoque es que funcionará con cualquier modelo en R, desde el más simple hasta el más complejo.</p>
<p>Solo estás limitado por tus habilidades de visualización. Para obtener más ideas sobre cómo visualizar tipos de modelos más complejos, puedes probar <a href="http://vita.had.co.nz/papers/model-vis.html" class="uri">http://vita.had.co.nz/papers/model-vis.html</a>.</p>
<pre class="r"><code>ggplot(sim1, aes(x)) +
  geom_point(aes(y = y)) +
  geom_line(aes(y = pred), data = grid, colour = &quot;red&quot;, size = 1)</code></pre>
<p><img src="Modelacion_files/figure-html/viz-model-3-1.png" width="624" /></p>
</div>
<div id="section-residuos" class="section level3">
<h3>Residuos</h3>
<p>La otra cara de las predicciones son los <strong>residuos</strong>. Las predicciones le indican el patrón que ha capturado el modelo y los residuales le indican qué se ha perdido el modelo. Los residuos son solo las distancias entre los valores observados y predichos que calculamos anteriormente.</p>
<p>Agregamos residuos a los datos con <code>add_residuals()</code>, que funciona de manera muy similar a <code>add_predictions()</code>.</p>
<p>Sin embargo, ten en cuenta que usamos el conjunto de datos original, no una cuadrícula fabricada. Esto se debe a que para calcular los residuos necesitamos valores de <code>y</code> reales.</p>
<pre class="r"><code>sim1 &lt;- sim1 %&gt;% 
  add_residuals(sim1_mod)
sim1</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["x"],"name":[1],"type":["int"],"align":["right"]},{"label":["y"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["resid"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"4.199913","3":"-2.072442018"},{"1":"1","2":"7.510634","3":"1.238279125"},{"1":"1","2":"2.125473","3":"-4.146882207"},{"1":"2","2":"8.988857","3":"0.664969362"},{"1":"2","2":"10.243105","3":"1.919217378"},{"1":"2","2":"11.296823","3":"2.972935148"},{"1":"3","2":"7.356365","3":"-3.019056466"},{"1":"3","2":"10.505349","3":"0.129928252"},{"1":"3","2":"10.511601","3":"0.136179642"},{"1":"4","2":"12.434589","3":"0.007634878"},{"1":"4","2":"11.892601","3":"-0.534352991"},{"1":"4","2":"14.257964","3":"1.831009860"},{"1":"5","2":"19.130050","3":"4.651562487"},{"1":"5","2":"11.738021","3":"-2.740466108"},{"1":"5","2":"16.024854","3":"1.546366596"},{"1":"6","2":"13.273977","3":"-3.256043368"},{"1":"6","2":"15.955975","3":"-0.574045413"},{"1":"6","2":"16.894796","3":"0.364775796"},{"1":"7","2":"20.085993","3":"1.504439222"},{"1":"7","2":"17.171850","3":"-1.409703118"},{"1":"7","2":"19.936309","3":"1.354755377"},{"1":"8","2":"21.725903","3":"1.092815968"},{"1":"8","2":"18.390913","3":"-2.242173633"},{"1":"8","2":"22.475553","3":"1.842466099"},{"1":"9","2":"26.777010","3":"4.092390235"},{"1":"9","2":"22.805110","3":"0.120490168"},{"1":"9","2":"21.128305","3":"-1.556314330"},{"1":"10","2":"24.968099","3":"0.231946675"},{"1":"10","2":"23.346422","3":"-1.389730610"},{"1":"10","2":"21.975201","3":"-2.760952005"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Hay algunas formas diferentes de entender lo que nos dicen los residuos sobre el modelo. Una forma es simplemente dibujar un polígono de frecuencia para ayudarnos a comprender la dispersión de los residuos:</p>
<pre class="r"><code>ggplot(sim1, aes(resid)) + 
  geom_freqpoly(binwidth = 0.5)</code></pre>
<p><img src="Modelacion_files/figure-html/viz-model-5-1.png" width="624" /></p>
<p>Esto ayuda a calibrar la calidad del modelo: ¿a qué distancia están las predicciones de los valores observados? Ten en cuenta que el promedio del residual siempre será 0.</p>
<p>A menudo, querrás volver a crear gráficos utilizando los residuos en lugar del predictor original. Verás mucho de eso en la siguiente sección.</p>
<pre class="r"><code>ggplot(sim1, aes(x, resid)) + 
  geom_ref_line(h = 0) +
  geom_point() </code></pre>
<p><img src="Modelacion_files/figure-html/viz-model-6-1.png" width="624" /></p>
<p>Esto parece un ruido aleatorio, lo que sugiere que nuestro modelo ha hecho un buen trabajo al capturar los patrones en el conjunto de datos.</p>
</div>
<div id="section-ejercicios-1" class="section level3">
<h3>Ejercicios</h3>
<p>1 - En lugar de usar <code>lm()</code> para ajustar una línea recta, puede usar <code>loess()</code> para ajustar una curva suave. Repita el proceso de ajuste del modelo, generación de cuadrículas, predicciones y visualización en <code>sim1</code> usando <code>loess()</code> en lugar de <code>lm()</code>. ¿Cómo se compara el resultado con <code>geom_smooth()</code>?</p>
<p>2 - <code>add_predictions()</code> está emparejado con <code>collect_predictions()</code> y <code>spread_predictions()</code>. ¿En qué se diferencian estas tres funciones?</p>
<p>3 - ¿Qué hace <code>geom_ref_line()</code>? ¿De qué paquete viene? ¿Por qué es útil e importante mostrar una línea de referencia en los gráficos que muestran los residuos?</p>
<p>4 - ¿Por qué querrías mirar un polígono de frecuencia de residuos absolutos? ¿Cuáles son los pros y los contras en comparación con observar los residuos sin procesar?</p>
</div>
</div>
<div id="section-fórmulas-y-familias-de-modelos" class="section level2">
<h2>Fórmulas y familias de modelos</h2>
<p>Has visto fórmulas antes al usar <code>facet_wrap()</code> y <code>facet_grid()</code>. En R, las fórmulas proporcionan una forma general de obtener un <strong>comportamiento especial</strong>. En lugar de evaluar los valores de las variables de inmediato, los capturan para que puedan ser interpretados por la función.</p>
<p>La mayoría de las funciones de modelado en R utilizan una conversión estándar de fórmulas a funciones.</p>
<p>Ya has visto una conversión simple: <code>y ~ x</code> se traduce en <code>y = a_1 + a_2 * x</code>.</p>
<p>Si deseas ver lo que realmente hace R, puede usar la función <code>model_matrix()</code>.</p>
<p>Toma un dataframe y una fórmula y devuelve un tibble que define la ecuación del modelo: cada columna en la salida está asociada con un coeficiente en el modelo, la función es siempre <code>y = a_1 * out1 + a_2 * out_2</code>.</p>
<p>Para el caso más simple de <code>y ~ x1</code>, esto nos muestra algo interesante:</p>
<pre class="r"><code>df &lt;- tribble(
  ~y, ~x1, ~x2,
  4, 2, 5,
  5, 1, 6
)

model_matrix(df, y ~ x1)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["(Intercept)"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["x1"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"2"},{"1":"1","2":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>La forma en que R agrega la intersección al modelo es simplemente teniendo una columna llena de unos. De forma predeterminada, R siempre agregará esta columna. Si no lo desea, debe eliminarlo explícitamente con <code>-1</code>:</p>
<pre class="r"><code>model_matrix(df, y ~ x1 - 1)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["x1"],"name":[1],"type":["dbl"],"align":["right"]}],"data":[{"1":"2"},{"1":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>La matriz del modelo crece de una manera nada sorprendente cuando agrega más variables al modelo:</p>
<pre class="r"><code>model_matrix(df, y ~ x1 + x2)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["(Intercept)"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["x1"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["x2"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"2","3":"5"},{"1":"1","2":"1","3":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Esta notación de fórmula a veces se denomina <strong>notación de Wilkinson-Rogers</strong> y fue descrita inicialmente en Descripción simbólica de modelos factoriales para análisis de varianza, por G. N. Wilkinson y C. E. Rogers <a href="https://www.jstor.org/stable/2346786" class="uri">https://www.jstor.org/stable/2346786</a>.</p>
<p>Vale la pena investigar y leer el artículo original si deseas comprender todos los detalles del álgebra de modelado.</p>
<p>Las siguientes secciones amplían el funcionamiento de esta notación de fórmula para variables categóricas, interacciones y transformaciones.</p>
<div id="section-variables-categóricas" class="section level3">
<h3>Variables categóricas</h3>
<p>Generar una función a partir de una fórmula es sencillo cuando el predictor es continuo, pero las cosas se complican un poco cuando el predictor es categórico.</p>
<p>Imagina que tienes una fórmula como <code>y ~ sex</code>, donde el <code>sex</code> puede ser masculino o femenino.</p>
<p>No tiene sentido convertir eso a una fórmula como <code>y = x_0 + x_1 * sex</code> porque el <code>sex</code> no es un número, ¡no puedes multiplicarlo! En cambio, lo que hace R es convertirlo en <code>y = x_0 + x_1 * sex_male</code> donde <code>sex_male</code> es uno si el sexo es masculino y cero en caso contrario:</p>
<pre class="r"><code>df &lt;- tribble(
  ~ sex, ~ response,
  &quot;male&quot;, 1,
  &quot;female&quot;, 2,
  &quot;male&quot;, 1
)
model_matrix(df, response ~ sex)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["(Intercept)"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["sexmale"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"1"},{"1":"1","2":"0"},{"1":"1","2":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Quizás te preguntes por qué R tampoco crea una columna de sexo femenino. El problema es que crearía una columna que es perfectamente predecible en función de las otras columnas (es decir, <code>sexfemale = 1 - sexmale</code>).</p>
<p>Desafortunadamente, los detalles exactos de por qué esto es un problema están más allá del alcance de esta sección, pero básicamente crea una familia de modelos que es demasiado flexible y tendrá infinitos modelos que están igualmente cerca de los datos.</p>
<p>Sin embargo, afortunadamente, si se enfoca en visualizar predicciones, no necesita preocuparse por la parametrización exacta. Veamos algunos datos y modelos para concretarlo. Aquí está el conjunto de datos <code>sim2</code> de <code>modelr</code>:</p>
<pre class="r"><code>ggplot(sim2) + 
  geom_point(aes(x, y))</code></pre>
<p><img src="Modelacion_files/figure-html/categori-model-2-1.png" width="624" /></p>
<p>Podemos ajustarle un modelo y generar predicciones:</p>
<pre class="r"><code>mod2 &lt;- lm(y ~ x, data = sim2)

grid &lt;- sim2 %&gt;% 
  data_grid(x) %&gt;% 
  add_predictions(mod2)
grid</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["x"],"name":[1],"type":["chr"],"align":["left"]},{"label":["pred"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"a","2":"1.152166"},{"1":"b","2":"8.116039"},{"1":"c","2":"6.127191"},{"1":"d","2":"1.910981"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Efectivamente, un modelo con una <code>x</code> categórica predecirá el valor medio para cada categoría.</p>
<p>(¿Por qué? Porque la media minimiza la distancia cuadrática media de la raíz). Es fácil de ver si superponemos las predicciones sobre los datos originales:</p>
<pre class="r"><code>ggplot(sim2, aes(x)) + 
  geom_point(aes(y = y)) +
  geom_point(data = grid, aes(y = pred), colour = &quot;red&quot;, size = 4)</code></pre>
<p><img src="Modelacion_files/figure-html/categori-model-4-1.png" width="624" /></p>
<p>No puedes hacer predicciones sobre niveles que no observó. A veces, lo hará por accidente, por lo que es bueno reconocer este mensaje de error:</p>
<pre class="r"><code>tibble(x = &quot;e&quot;) %&gt;% 
  add_predictions(mod2)</code></pre>
<pre><code>## Error in model.frame.default(Terms, newdata, na.action = na.action, xlev = object$xlevels): factor x has new level e</code></pre>
</div>
<div id="section-interacciones-continuas-y-categóricas" class="section level3">
<h3>Interacciones (continuas y categóricas)</h3>
<p>¿Qué sucede cuando combinas una variable continua y una categórica? <code>sim3</code> contiene un predictor categórico y un predictor continuo. Podemos visualizarlo con una trama simple:</p>
<pre class="r"><code>ggplot(sim3, aes(x1, y)) + 
  geom_point(aes(colour = x2))</code></pre>
<p><img src="Modelacion_files/figure-html/interac-model-1-1.png" width="624" /></p>
<p>Hay dos modelos posibles que podría ajustar a estos datos:</p>
<pre class="r"><code>mod1 &lt;- lm(y ~ x1 + x2, data = sim3)
mod2 &lt;- lm(y ~ x1 * x2, data = sim3)</code></pre>
<p>Cuando agrega variables con <code>+</code>, el modelo estimará cada efecto independientemente de todos los demás. Es posible ajustar la llamada interacción usando <code>*</code>. Por ejemplo, <code>y ~ x1 * x2</code> se traduce en <code>y = a_0 + a_1 * x1 + a_2 * x2 + a_12 * x1 * x2</code>.</p>
<p>Ten en cuenta que siempre que utilices <code>*</code>, tanto la interacción como los componentes individuales se incluyen en el modelo.</p>
<p>Para visualizar estos modelos necesitamos dos nuevos trucos:</p>
<ul>
<li><p>Tenemos dos predictores, por lo que necesitamos dar <code>data_grid()</code> ambas variables. Encuentra todos los valores únicos de <code>x1</code> y <code>x2</code> y luego genera todas las combinaciones.</p></li>
<li><p>Para generar predicciones de ambos modelos simultáneamente, podemos usar <code>collect_predictions()</code> que agrega cada predicción como una fila. El complemento de <code>collect_predictions()</code> es <code>spread_predictions()</code> que agrega cada predicción a una nueva columna.</p></li>
</ul>
<p>Juntos esto nos da:</p>
<pre class="r"><code>grid &lt;- sim3 %&gt;% 
  data_grid(x1, x2) %&gt;% 
  gather_predictions(mod1, mod2)
grid</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["model"],"name":[1],"type":["chr"],"align":["left"]},{"label":["x1"],"name":[2],"type":["int"],"align":["right"]},{"label":["x2"],"name":[3],"type":["fct"],"align":["left"]},{"label":["pred"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"mod1","2":"1","3":"a","4":"1.67492811"},{"1":"mod1","2":"1","3":"b","4":"4.56273896"},{"1":"mod1","2":"1","3":"c","4":"6.48066399"},{"1":"mod1","2":"1","3":"d","4":"4.03451486"},{"1":"mod1","2":"2","3":"a","4":"1.47819036"},{"1":"mod1","2":"2","3":"b","4":"4.36600121"},{"1":"mod1","2":"2","3":"c","4":"6.28392624"},{"1":"mod1","2":"2","3":"d","4":"3.83777710"},{"1":"mod1","2":"3","3":"a","4":"1.28145260"},{"1":"mod1","2":"3","3":"b","4":"4.16926345"},{"1":"mod1","2":"3","3":"c","4":"6.08718849"},{"1":"mod1","2":"3","3":"d","4":"3.64103935"},{"1":"mod1","2":"4","3":"a","4":"1.08471485"},{"1":"mod1","2":"4","3":"b","4":"3.97252570"},{"1":"mod1","2":"4","3":"c","4":"5.89045073"},{"1":"mod1","2":"4","3":"d","4":"3.44430159"},{"1":"mod1","2":"5","3":"a","4":"0.88797710"},{"1":"mod1","2":"5","3":"b","4":"3.77578795"},{"1":"mod1","2":"5","3":"c","4":"5.69371298"},{"1":"mod1","2":"5","3":"d","4":"3.24756384"},{"1":"mod1","2":"6","3":"a","4":"0.69123934"},{"1":"mod1","2":"6","3":"b","4":"3.57905019"},{"1":"mod1","2":"6","3":"c","4":"5.49697522"},{"1":"mod1","2":"6","3":"d","4":"3.05082609"},{"1":"mod1","2":"7","3":"a","4":"0.49450159"},{"1":"mod1","2":"7","3":"b","4":"3.38231244"},{"1":"mod1","2":"7","3":"c","4":"5.30023747"},{"1":"mod1","2":"7","3":"d","4":"2.85408833"},{"1":"mod1","2":"8","3":"a","4":"0.29776383"},{"1":"mod1","2":"8","3":"b","4":"3.18557468"},{"1":"mod1","2":"8","3":"c","4":"5.10349972"},{"1":"mod1","2":"8","3":"d","4":"2.65735058"},{"1":"mod1","2":"9","3":"a","4":"0.10102608"},{"1":"mod1","2":"9","3":"b","4":"2.98883693"},{"1":"mod1","2":"9","3":"c","4":"4.90676196"},{"1":"mod1","2":"9","3":"d","4":"2.46061282"},{"1":"mod1","2":"10","3":"a","4":"-0.09571167"},{"1":"mod1","2":"10","3":"b","4":"2.79209918"},{"1":"mod1","2":"10","3":"c","4":"4.71002421"},{"1":"mod1","2":"10","3":"d","4":"2.26387507"},{"1":"mod2","2":"1","3":"a","4":"1.20821821"},{"1":"mod2","2":"1","3":"b","4":"7.51731284"},{"1":"mod2","2":"1","3":"c","4":"5.70726631"},{"1":"mod2","2":"1","3":"d","4":"2.32004856"},{"1":"mod2","2":"2","3":"a","4":"1.11519377"},{"1":"mod2","2":"2","3":"b","4":"6.66400311"},{"1":"mod2","2":"2","3":"c","4":"5.68239471"},{"1":"mod2","2":"2","3":"d","4":"2.50430332"},{"1":"mod2","2":"3","3":"a","4":"1.02216933"},{"1":"mod2","2":"3","3":"b","4":"5.81069338"},{"1":"mod2","2":"3","3":"c","4":"5.65752310"},{"1":"mod2","2":"3","3":"d","4":"2.68855807"},{"1":"mod2","2":"4","3":"a","4":"0.92914488"},{"1":"mod2","2":"4","3":"b","4":"4.95738366"},{"1":"mod2","2":"4","3":"c","4":"5.63265150"},{"1":"mod2","2":"4","3":"d","4":"2.87281283"},{"1":"mod2","2":"5","3":"a","4":"0.83612044"},{"1":"mod2","2":"5","3":"b","4":"4.10407393"},{"1":"mod2","2":"5","3":"c","4":"5.60777990"},{"1":"mod2","2":"5","3":"d","4":"3.05706759"},{"1":"mod2","2":"6","3":"a","4":"0.74309600"},{"1":"mod2","2":"6","3":"b","4":"3.25076420"},{"1":"mod2","2":"6","3":"c","4":"5.58290830"},{"1":"mod2","2":"6","3":"d","4":"3.24132234"},{"1":"mod2","2":"7","3":"a","4":"0.65007155"},{"1":"mod2","2":"7","3":"b","4":"2.39745448"},{"1":"mod2","2":"7","3":"c","4":"5.55803670"},{"1":"mod2","2":"7","3":"d","4":"3.42557710"},{"1":"mod2","2":"8","3":"a","4":"0.55704711"},{"1":"mod2","2":"8","3":"b","4":"1.54414475"},{"1":"mod2","2":"8","3":"c","4":"5.53316510"},{"1":"mod2","2":"8","3":"d","4":"3.60983185"},{"1":"mod2","2":"9","3":"a","4":"0.46402267"},{"1":"mod2","2":"9","3":"b","4":"0.69083502"},{"1":"mod2","2":"9","3":"c","4":"5.50829350"},{"1":"mod2","2":"9","3":"d","4":"3.79408661"},{"1":"mod2","2":"10","3":"a","4":"0.37099822"},{"1":"mod2","2":"10","3":"b","4":"-0.16247470"},{"1":"mod2","2":"10","3":"c","4":"5.48342190"},{"1":"mod2","2":"10","3":"d","4":"3.97834136"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Podemos visualizar los resultados para ambos modelos en una gráfica usando facetas:</p>
<pre class="r"><code>ggplot(sim3, aes(x1, y, colour = x2)) + 
  geom_point() + 
  geom_line(data = grid, aes(y = pred)) + 
  facet_wrap(~ model)</code></pre>
<p><img src="Modelacion_files/figure-html/interac-model-3-1.png" width="624" /></p>
<p>Ten en cuenta que el modelo que usa <code>+</code> tiene la misma pendiente para cada línea, pero diferentes intersecciones. El modelo que usa <code>*</code> tiene una pendiente e intersección diferentes para cada línea.</p>
<p>¿Qué modelo es mejor para estos datos? Podemos echar un vistazo a los residuos. Aquí he facetado tanto por modelo como por <code>x2</code> porque hace que sea más fácil ver el patrón dentro de cada grupo.</p>
<pre class="r"><code>sim3 &lt;- sim3 %&gt;% 
  gather_residuals(mod1, mod2)

ggplot(sim3, aes(x1, resid, colour = x2)) + 
  geom_point() + 
  facet_grid(model ~ x2)</code></pre>
<p><img src="Modelacion_files/figure-html/interac-model-4-1.png" width="624" /></p>
<p>Hay poco patrón obvio en los residuos de `<code>mod2</code>. Los residuos de <code>mod1</code> muestran que el modelo claramente ha perdido algún patrón en <code>b</code>, y menos, pero todavía está presente el patrón en <code>c</code> y <code>d</code>.</p>
<p>Quizás se pregunte si existe una forma precisa de saber cuál de <code>mod1</code> o <code>mod2</code> es mejor. Lo hay, pero requiere mucha formación matemática, y realmente no nos importa. Aquí, estamos interesados en una evaluación cualitativa de si el modelo ha capturado o no el patrón que nos interesa.</p>
</div>
<div id="section-interacciones-dos-continuas" class="section level3">
<h3>Interacciones (Dos continuas)</h3>
<p>Echemos un vistazo al modelo equivalente para dos variables continuas. Inicialmente, las cosas proceden de manera casi idéntica al ejemplo anterior:</p>
<pre class="r"><code>mod1 &lt;- lm(y ~ x1 + x2, data = sim4)
mod2 &lt;- lm(y ~ x1 * x2, data = sim4)

grid &lt;- sim4 %&gt;% 
  data_grid(
    x1 = seq_range(x1, 5), 
    x2 = seq_range(x2, 5) 
  ) %&gt;% 
  gather_predictions(mod1, mod2)
grid</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["model"],"name":[1],"type":["chr"],"align":["left"]},{"label":["x1"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["x2"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["pred"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"mod1","2":"-1.0","3":"-1.0","4":"0.99630938"},{"1":"mod1","2":"-1.0","3":"-0.5","4":"-0.39494837"},{"1":"mod1","2":"-1.0","3":"0.0","4":"-1.78620613"},{"1":"mod1","2":"-1.0","3":"0.5","4":"-3.17746388"},{"1":"mod1","2":"-1.0","3":"1.0","4":"-4.56872164"},{"1":"mod1","2":"-0.5","3":"-1.0","4":"1.90714243"},{"1":"mod1","2":"-0.5","3":"-0.5","4":"0.51588467"},{"1":"mod1","2":"-0.5","3":"0.0","4":"-0.87537308"},{"1":"mod1","2":"-0.5","3":"0.5","4":"-2.26663084"},{"1":"mod1","2":"-0.5","3":"1.0","4":"-3.65788859"},{"1":"mod1","2":"0.0","3":"-1.0","4":"2.81797548"},{"1":"mod1","2":"0.0","3":"-0.5","4":"1.42671772"},{"1":"mod1","2":"0.0","3":"0.0","4":"0.03545997"},{"1":"mod1","2":"0.0","3":"0.5","4":"-1.35579779"},{"1":"mod1","2":"0.0","3":"1.0","4":"-2.74705554"},{"1":"mod1","2":"0.5","3":"-1.0","4":"3.72880852"},{"1":"mod1","2":"0.5","3":"-0.5","4":"2.33755077"},{"1":"mod1","2":"0.5","3":"0.0","4":"0.94629301"},{"1":"mod1","2":"0.5","3":"0.5","4":"-0.44496474"},{"1":"mod1","2":"0.5","3":"1.0","4":"-1.83622250"},{"1":"mod1","2":"1.0","3":"-1.0","4":"4.63964157"},{"1":"mod1","2":"1.0","3":"-0.5","4":"3.24838382"},{"1":"mod1","2":"1.0","3":"0.0","4":"1.85712606"},{"1":"mod1","2":"1.0","3":"0.5","4":"0.46586831"},{"1":"mod1","2":"1.0","3":"1.0","4":"-0.92538945"},{"1":"mod2","2":"-1.0","3":"-1.0","4":"1.94858820"},{"1":"mod2","2":"-1.0","3":"-0.5","4":"0.08119103"},{"1":"mod2","2":"-1.0","3":"0.0","4":"-1.78620613"},{"1":"mod2","2":"-1.0","3":"0.5","4":"-3.65360329"},{"1":"mod2","2":"-1.0","3":"1.0","4":"-5.52100046"},{"1":"mod2","2":"-0.5","3":"-1.0","4":"2.38328184"},{"1":"mod2","2":"-0.5","3":"-0.5","4":"0.75395438"},{"1":"mod2","2":"-0.5","3":"0.0","4":"-0.87537308"},{"1":"mod2","2":"-0.5","3":"0.5","4":"-2.50470054"},{"1":"mod2","2":"-0.5","3":"1.0","4":"-4.13402800"},{"1":"mod2","2":"0.0","3":"-1.0","4":"2.81797548"},{"1":"mod2","2":"0.0","3":"-0.5","4":"1.42671772"},{"1":"mod2","2":"0.0","3":"0.0","4":"0.03545997"},{"1":"mod2","2":"0.0","3":"0.5","4":"-1.35579779"},{"1":"mod2","2":"0.0","3":"1.0","4":"-2.74705554"},{"1":"mod2","2":"0.5","3":"-1.0","4":"3.25266911"},{"1":"mod2","2":"0.5","3":"-0.5","4":"2.09948106"},{"1":"mod2","2":"0.5","3":"0.0","4":"0.94629301"},{"1":"mod2","2":"0.5","3":"0.5","4":"-0.20689504"},{"1":"mod2","2":"0.5","3":"1.0","4":"-1.36008309"},{"1":"mod2","2":"1.0","3":"-1.0","4":"3.68736275"},{"1":"mod2","2":"1.0","3":"-0.5","4":"2.77224441"},{"1":"mod2","2":"1.0","3":"0.0","4":"1.85712606"},{"1":"mod2","2":"1.0","3":"0.5","4":"0.94200772"},{"1":"mod2","2":"1.0","3":"1.0","4":"0.02688937"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Ten en cuenta mi uso de <code>seq_range()</code> dentro de <code>data_grid()</code>. En lugar de usar cada valor único de <code>x</code>, vamos a usar una cuadrícula espaciada regularmente de cinco valores entre los números mínimo y máximo.</p>
<p>Probablemente no sea muy importante aquí, pero es una técnica útil en general. Hay otros dos argumentos útiles para <code>seq_range()</code>:</p>
<ul>
<li><code>pretty = TRUE</code> generará una secuencia “bonita”, es decir, algo que se ve bien para el ojo humano. Esto es útil si deseas producir tablas de salida:</li>
</ul>
<pre class="r"><code>seq_range(c(0.0123, 0.923423), n = 5)</code></pre>
<pre><code>## [1] 0.0123000 0.2400808 0.4678615 0.6956423 0.9234230</code></pre>
<pre class="r"><code>seq_range(c(0.0123, 0.923423), n = 5, pretty = TRUE)</code></pre>
<pre><code>## [1] 0.0 0.2 0.4 0.6 0.8 1.0</code></pre>
<ul>
<li><code>trim = 0.1</code> recortará el <code>10%</code> de los valores finales. Esto es útil si las variables tienen una distribución de cola larga y desea enfocarse en generar valores cerca del centro:</li>
</ul>
<pre class="r"><code>x1 &lt;- rcauchy(100)
seq_range(x1, n = 5)</code></pre>
<pre><code>## [1] -15.593391  -6.549223   2.494944  11.539112  20.583280</code></pre>
<pre class="r"><code>seq_range(x1, n = 5, trim = 0.10)</code></pre>
<pre><code>## [1] -6.4750465 -3.7092152 -0.9433839  1.8224474  4.5882787</code></pre>
<pre class="r"><code>seq_range(x1, n = 5, trim = 0.25)</code></pre>
<pre><code>## [1] -3.0238056 -1.9016050 -0.7794044  0.3427962  1.4649967</code></pre>
<pre class="r"><code>seq_range(x1, n = 5, trim = 0.50)</code></pre>
<pre><code>## [1] -1.3871297 -0.8421630 -0.2971964  0.2477702  0.7927368</code></pre>
<ul>
<li><code>expand = 0.1</code> es en cierto sentido lo opuesto a <code>trim()</code> expande el rango en un <code>10%</code>.</li>
</ul>
<pre class="r"><code>x2 &lt;- c(0, 1)
seq_range(x2, n = 5)</code></pre>
<pre><code>## [1] 0.00 0.25 0.50 0.75 1.00</code></pre>
<pre class="r"><code>seq_range(x2, n = 5, expand = 0.10)</code></pre>
<pre><code>## [1] -0.050  0.225  0.500  0.775  1.050</code></pre>
<pre class="r"><code>seq_range(x2, n = 5, expand = 0.25)</code></pre>
<pre><code>## [1] -0.1250  0.1875  0.5000  0.8125  1.1250</code></pre>
<pre class="r"><code>seq_range(x2, n = 5, expand = 0.50)</code></pre>
<pre><code>## [1] -0.250  0.125  0.500  0.875  1.250</code></pre>
<p>A continuación, intentemos visualizar ese modelo. Tenemos dos predictores continuos, por lo que puede imaginar el modelo como una superficie 3D. Podríamos mostrar eso usando <code>geom_tile()</code>:</p>
<pre class="r"><code>ggplot(grid, aes(x1, x2)) + 
  geom_tile(aes(fill = pred)) + 
  facet_wrap(~ model)</code></pre>
<p><img src="Modelacion_files/figure-html/interac-model-9-1.png" width="624" /></p>
<p>¡Eso no sugiere que los modelos sean muy diferentes! Pero eso es en parte una ilusión: nuestros ojos y cerebros no son muy buenos para comparar con precisión tonos de color. En lugar de mirar la superficie desde la parte superior, podríamos mirarla desde cualquier lado, mostrando múltiples cortes:</p>
<pre class="r"><code>ggplot(grid, aes(x1, pred, colour = x2, group = x2)) + 
  geom_line() +
  facet_wrap(~ model)</code></pre>
<p><img src="Modelacion_files/figure-html/interac-model-10-1.png" width="624" /></p>
<pre class="r"><code>ggplot(grid, aes(x2, pred, colour = x1, group = x1)) + 
  geom_line() +
  facet_wrap(~ model)</code></pre>
<p><img src="Modelacion_files/figure-html/interac-model-10-2.png" width="624" /></p>
<p>Esto le muestra que la interacción entre dos variables continuas funciona básicamente de la misma manera que para una variable categórica y continua. Una interacción dice que no hay un desplazamiento fijo: debe considerar ambos valores de <code>x1</code> y <code>x2</code> simultáneamente para predecir <code>y</code>.</p>
<p>Puede ver que incluso con solo dos variables continuas, obtener buenas visualizaciones es difícil. Pero eso es razonable: ¡no debería esperar que sea fácil entender cómo interactúan tres o más variables simultáneamente!</p>
<p>Pero, nuevamente, nos ahorramos un poco porque usamos modelos para la exploración y usted puede construir su modelo gradualmente con el tiempo. El modelo no tiene que ser perfecto, solo tiene que ayudarlo a revelar un poco más sobre sus datos.</p>
<p>Pasé algún tiempo mirando los residuos para ver si podía averiguar si <code>mod2</code> lo hizo mejor que <code>mod1</code>.</p>
<p>Creo que sí, pero es bastante sutil. Tendrá la oportunidad de trabajar en ello en los ejercicios.</p>
</div>
<div id="section-transformaciones" class="section level3">
<h3>Transformaciones</h3>
<p>También puede realizar transformaciones dentro de la fórmula del modelo. Por ejemplo, <code>log (y) ~ sqrt (x1) + x2</code> se transforma en <code>log (y) = a_1 + a_2 * sqrt (x1) + a_3 * x2</code>.</p>
<p>Si su transformación incluye <code>+</code>, <code>*</code>, <code>^</code> o <code>-</code>, deberá envolverla en <code>I()</code> para que R no la trate como parte de la especificación del modelo.</p>
<p>Por ejemplo, <code>y ~ x + I (x ^ 2)</code> se traduce en <code>y = a_1 + a_2 * x + a_3 * x ^ 2</code>. Si olvida <code>I()</code> y especifica <code>y ~ x ^ 2 + x</code>, R calculará <code>y ~ x * x + x</code>.</p>
<p><code>x * x</code> significa la interacción de <code>x</code> consigo mismo, que es lo mismo que <code>x</code>. R descarta automáticamente las variables redundantes para que <code>x + x</code> se convierta en x, lo que significa que <code>y ~ x ^ 2 + x</code> especifica la función <code>y = a_1 + a_2 * x</code>. ¡Probablemente eso no sea lo que pretendías!</p>
<p>Nuevamente, si te confunde acerca de lo que está haciendo tu modelo, siempre puedes usar <code>model_matrix()</code> para ver exactamente qué ecuación <code>lm()</code> encaja:</p>
<pre class="r"><code>df &lt;- tribble(
  ~y, ~x,
   1,  1,
   2,  2, 
   3,  3
)

model_matrix(df, y ~ x^2 + x)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["(Intercept)"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["x"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"1"},{"1":"1","2":"2"},{"1":"1","2":"3"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>model_matrix(df, y ~ I(x^2) + x)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["(Intercept)"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["I(x^2)"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["x"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"1","3":"1"},{"1":"1","2":"4","3":"2"},{"1":"1","2":"9","3":"3"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Las transformaciones son útiles porque puede usarlas para aproximar funciones no lineales. Si has tomado una clase de cálculo, es posible que haya oído hablar del teorema de Taylor, que dice que puede aproximar cualquier función suave con una suma infinita de polinomios.</p>
<p>Eso significa que puede usar una función polinomial para acercarse arbitrariamente a una función suave ajustando una ecuación como <code>y = a_1 + a_2 * x + a_3 * x ^ 2 + a_4 * x ^ 3</code>.</p>
<p>Escribir esa secuencia a mano es tedioso, por lo que R proporciona una función auxiliar: <code>poly()</code>:</p>
<pre class="r"><code>model_matrix(df, y ~ poly(x, 2))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["(Intercept)"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["poly(x, 2)1"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["poly(x, 2)2"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"-7.071068e-01","3":"0.4082483"},{"1":"1","2":"-9.073800e-17","3":"-0.8164966"},{"1":"1","2":"7.071068e-01","3":"0.4082483"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Sin embargo, hay un problema importante con el uso de <code>poly()</code>: fuera del rango de los datos, los polinomios se disparan rápidamente al infinito positivo o negativo. Una alternativa más segura es utilizar la spline natural, <code>splines::ns()</code>.</p>
<pre class="r"><code>library(splines)
model_matrix(df, y ~ ns(x, 2))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["(Intercept)"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["ns(x, 2)1"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["ns(x, 2)2"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"0.0000000","3":"0.0000000"},{"1":"1","2":"0.5662628","3":"-0.2108419"},{"1":"1","2":"0.3440969","3":"0.7706021"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Veamos cómo se ve cuando intentamos aproximar una función no lineal:</p>
<pre class="r"><code>sim5 &lt;- tibble(
  x = seq(0, 3.5 * pi, length = 50),
  y = 4 * sin(x) + rnorm(length(x))
)

ggplot(sim5, aes(x, y)) +
  geom_point()</code></pre>
<p><img src="Modelacion_files/figure-html/interac-model-14-1.png" width="624" /></p>
<p>Vamos a ajustar cinco modelos a estos datos.</p>
<pre class="r"><code>mod1 &lt;- lm(y ~ ns(x, 1), data = sim5)
mod2 &lt;- lm(y ~ ns(x, 2), data = sim5)
mod3 &lt;- lm(y ~ ns(x, 3), data = sim5)
mod4 &lt;- lm(y ~ ns(x, 4), data = sim5)
mod5 &lt;- lm(y ~ ns(x, 5), data = sim5)

grid &lt;- sim5 %&gt;% 
  data_grid(x = seq_range(x, n = 50, expand = 0.1)) %&gt;% 
  gather_predictions(mod1, mod2, mod3, mod4, mod5, .pred = &quot;y&quot;)

ggplot(sim5, aes(x, y)) + 
  geom_point() +
  geom_line(data = grid, colour = &quot;red&quot;) +
  facet_wrap(~ model)</code></pre>
<p><img src="Modelacion_files/figure-html/interac-model-15-1.png" width="624" /></p>
<p>Tenga en cuenta que la extrapolación fuera del rango de los datos es claramente mala. Ésta es la desventaja de aproximar una función con un polinomio. Pero este es un problema muy real con todos los modelos: el modelo nunca puede decirle si el comportamiento es verdadero cuando comienza a extrapolar fuera del rango de los datos que ha visto.</p>
</div>
<div id="section-ejercicios-2" class="section level3">
<h3>Ejercicios</h3>
<p>1 - Lo que sucede si repite el análisis de SIM2 usando un modelo sin una intersección. ¿Qué pasa con la ecuación modelo? ¿Qué pasa con las predicciones?</p>
<p>2 - Usa <code>Model_Matrix()</code> para explorar las ecuaciones generadas para los modelos que apto para <code>SIM3</code> y <code>SIM4</code>. ¿Por qué es <code>*</code> una buena taquigrafía para la interacción?</p>
<p>3 - Usando los principios básicos, convertir las fórmulas en los siguientes dos modelos en funciones. (Pista: Comience con la conversión de la variable categórica en variables 0-1).</p>
<pre class="r"><code>mod1 &lt;- lm(y ~ x1 + x2, data = sim3)
mod2 &lt;- lm(y ~ x1 * x2, data = sim3)</code></pre>
<p>4 - Para <code>SIM4</code>, ¿cuál de <code>mod1</code> y <code>mod2</code> es mejor? Creo que <code>MOD2</code> hace un trabajo ligeramente mejor para eliminar los patrones, pero es bastante sutil. ¿Puedes llegar a una gráfica para apoyar mi reclamo?</p>
</div>
<div id="section-valores-faltantes" class="section level3">
<h3>Valores faltantes</h3>
<p>Los valores faltantes, obviamente, no pueden transmitir ninguna información sobre la relación entre las variables, por lo que las funciones de modelado dejarán caer las filas que contengan valores faltantes. El comportamiento predeterminado de R es eliminarlos en silencio, pero <code>opcions(na.action = na.warn)</code> (ejecutarse en los requisitos previos), asegúrese de obtener una advertencia.</p>
<pre class="r"><code>df &lt;- tribble(
  ~x, ~y,
  1, 2.2,
  2, NA,
  3, 3.5,
  4, 8.3,
  NA, 10
)

mod &lt;- lm(y ~ x, data = df)</code></pre>
<pre><code>## Warning: Dropping 2 rows with missing values</code></pre>
<p>Para suprimir la advertencia, configure <code>na.action = na.exclude</code>:</p>
<pre class="r"><code>mod &lt;- lm(y ~ x, data = df, na.action = na.exclude)</code></pre>
<p>Siempre puedes ver exactamente cuántas observaciones se utilizaron con <code>nobs()</code>:</p>
<pre class="r"><code>nobs(mod)</code></pre>
<pre><code>## [1] 3</code></pre>
</div>
<div id="section-otras-familias-modelos" class="section level3">
<h3>Otras familias modelos</h3>
<p>Este capítulo se ha centrado exclusivamente en la clase de modelos lineales, que asume una relación de la forma <code>y = A_1 * x1 + A_2 * X2 + ... + A_N * XN</code>. Además, los modelos lineales asumen además que los residuos tienen una distribución normal, a la que no hemos hablado. Hay un gran conjunto de clases modelo que extienden el modelo lineal de varias maneras interesantes. Algunos de ellos son:</p>
<ul>
<li><p><strong>Modelos lineales generalizados</strong>, por ejemplo. <code>stats::glm()</code>. Los modelos lineales asumen que la respuesta es continua y el error tiene una distribución normal. Los modelos lineales generalizados extienden modelos lineales para incluir respuestas no continuas (por ejemplo, datos binarios o conteos). Trabajan definiendo una métrica a distancia en función de la idea estadística de probabilidad.</p></li>
<li><p><strong>Modelos aditivos generalizados</strong>, por ejemplo. <code>glmnet::glmnet()</code>, extienda los modelos lineales generalizados para incorporar funciones de suavidad arbitraria. Eso significa que puede escribir una fórmula como <code>y ~ s(x)</code> que se convierte en una ecuación como <code>y = f(x)</code> y deje que <code>gam()</code> estime lo que es esa función (sujeto a algunas restricciones de suavidad para hacer que el problema sea tratado).</p></li>
<li><p><strong>Modelos lineales penalizados</strong>, por ejemplo. <code>glmnet::glmnet()</code>, agregue un término de penalización a la distancia que penaliza los modelos complejos (según lo definido por la distancia entre el vector de parámetro y el origen). Esto tiende a hacer modelos que generalizan mejor a los nuevos conjuntos de datos de la misma población.</p></li>
<li><p><strong>Modelos lineales robustos</strong>, por ejemplo. <code>MASS::rlm()</code>, modifica la distancia a los puntos de peso descendente que están muy lejos. Esto los hace menos sensibles a la presencia de valores atípicos, a un costo de ser tan bueno cuando no hay valores atípicos.</p></li>
<li><p><strong>Árboles</strong>, por ejemplo. <code>rpart::rpart()</code>, ataca el problema de una manera completamente diferente a los modelos lineales. Se ajustan a un modelo constante sabio de piezas, dividiendo los datos en piezas progresivamente más pequeñas y más pequeñas. Los árboles no son terriblemente efectivos por sí mismos, pero son muy poderosos cuando se usan en agregados por modelos como <strong>random forests</strong> (por ejemplo, <code>randomForest::randomForest()</code>) o <strong>gradient boosting machines</strong> (por ejemplo, <code>xgboost::xgboost</code>).</p></li>
</ul>
<p>Todos estos modelos funcionan de manera similar desde una perspectiva de programación. Una vez que haya dominado modelos lineales, debe encontrar fácil dominar los mecánicos de estas otras clases de modelos. Ser un modelador experto es una mezcla de algunos principios generales buenos y tener una gran caja de herramientas de técnicas. Ahora que ha aprendido algunas herramientas generales y una clase útil de modelos, puede continuar y aprender más clases de otras fuentes.</p>
</div>
</div>
<div id="section-construir-un-modelo" class="section level2">
<h2>Construir un modelo</h2>
<p>En la sección anterior, aprendiste cómo funcionan los modelos lineales y aprendiste algunas herramientas básicas para comprender lo que un modelo le dice sobre tus datos. La sección anterior se centró en conjuntos de datos simulados. Este capítulo se enfocará en datos reales y te mostrará cómo puede construir progresivamente un modelo para ayudarlo a comprender los datos.</p>
<p>Aprovecharemos el hecho de que puede pensar en un modelo que particione tus datos en patrones y residuos.</p>
<p>Encontraremos patrones con visualización, luego los haremos concretos y precisos con un modelo.</p>
<p>Luego, repetiremos el proceso, pero reemplazaremos la variable de respuesta anterior con los residuos del modelo. El objetivo es pasar del conocimiento implícito en los datos y su cabeza al conocimiento explícito en un modelo cuantitativo.</p>
<p>Esto hace que sea más fácil de aplicar a nuevos dominios y más fácil de usar para otros.</p>
<p>Para conjuntos de datos muy grandes y complejos, esto supondrá mucho trabajo.</p>
<p>Ciertamente, existen enfoques alternativos: un enfoque más de aprendizaje automático es simplemente centrarse en la capacidad predictiva del modelo. Estos enfoques tienden a producir cajas negras: el modelo hace un muy buen trabajo al generar predicciones, pero no sabes por qué.</p>
<p>Este es un enfoque totalmente razonable, pero dificulta la aplicación de su conocimiento del mundo real al modelo. Eso, a su vez, dificulta evaluar si el modelo seguirá funcionando a largo plazo, a medida que cambien los fundamentos. Para la mayoría de los modelos reales, espero que utilice alguna combinación de este enfoque y un enfoque automatizado más clásico.</p>
<p>Es un desafío saber cuándo detenerse. Debe averiguar cuándo su modelo es lo suficientemente bueno y cuándo es poco probable que una inversión adicional valga la pena. Me gusta particularmente esta cita del usuario de reddit Broseidon241:</p>
<p>Hace mucho tiempo, en la clase de arte, mi maestra me dijo:</p>
<pre><code>“Un artista necesita saber cuándo está terminada una obra. No se puede ajustar algo a la perfección, envuélvalo. Si no le gusta, hágalo de nuevo. De lo contrario, comience algo nuevo ”.</code></pre>
<p>Más adelante en la vida, escuché</p>
<pre><code>“Una costurera pobre comete muchos errores. Una buena costurera trabaja duro para corregir esos errores. Una gran costurera no tiene miedo de tirar la prenda y empezar de nuevo &quot;.
– Broseidon241, https://www.reddit.com/r/datascience/comments/4irajq</code></pre>
<div id="section-prerrequisitos" class="section level3">
<h3>Prerrequisitos</h3>
<p>Usaremos las mismas herramientas que en el capítulo anterior, pero agregaremos algunos conjuntos de datos reales: vuelos de <code>nycflights13</code>. También necesitaremos lubridate para trabajar con la fecha/hora en los vuelos.</p>
<pre class="r"><code>library(tidyverse)
library(modelr)
options(na.action = na.warn)

library(nycflights13)
library(lubridate)    </code></pre>
<pre><code>## 
## Attaching package: &#39;lubridate&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     date, intersect, setdiff, union</code></pre>
</div>
<div id="section-qué-afecta-la-cantidad-de-vuelos-diarios" class="section level3">
<h3>¿Qué afecta la cantidad de vuelos diarios?</h3>
<p>Trabajemos en un proceso similar para un conjunto de datos que parece aún más simple a primera vista: la cantidad de vuelos que salen de Nueva York por día.</p>
<p>Este es un conjunto de datos realmente pequeño, solo 365 filas y 2 columnas, y no vamos a terminar con un modelo completamente realizado, pero como verá, los pasos a lo largo del camino nos ayudarán a comprender mejor los datos. Comencemos contando el número de vuelos por día y visualizándolo con <code>ggplot2</code>.</p>
<pre class="r"><code>daily &lt;- flights %&gt;% 
  mutate(date = make_date(year, month, day)) %&gt;% 
  group_by(date) %&gt;% 
  summarise(n = n())

daily</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["date"],"name":[1],"type":["date"],"align":["right"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"2013-01-01","2":"842"},{"1":"2013-01-02","2":"943"},{"1":"2013-01-03","2":"914"},{"1":"2013-01-04","2":"915"},{"1":"2013-01-05","2":"720"},{"1":"2013-01-06","2":"832"},{"1":"2013-01-07","2":"933"},{"1":"2013-01-08","2":"899"},{"1":"2013-01-09","2":"902"},{"1":"2013-01-10","2":"932"},{"1":"2013-01-11","2":"930"},{"1":"2013-01-12","2":"690"},{"1":"2013-01-13","2":"828"},{"1":"2013-01-14","2":"928"},{"1":"2013-01-15","2":"894"},{"1":"2013-01-16","2":"901"},{"1":"2013-01-17","2":"927"},{"1":"2013-01-18","2":"924"},{"1":"2013-01-19","2":"674"},{"1":"2013-01-20","2":"786"},{"1":"2013-01-21","2":"912"},{"1":"2013-01-22","2":"890"},{"1":"2013-01-23","2":"897"},{"1":"2013-01-24","2":"925"},{"1":"2013-01-25","2":"922"},{"1":"2013-01-26","2":"680"},{"1":"2013-01-27","2":"823"},{"1":"2013-01-28","2":"923"},{"1":"2013-01-29","2":"890"},{"1":"2013-01-30","2":"900"},{"1":"2013-01-31","2":"928"},{"1":"2013-02-01","2":"926"},{"1":"2013-02-02","2":"682"},{"1":"2013-02-03","2":"814"},{"1":"2013-02-04","2":"932"},{"1":"2013-02-05","2":"896"},{"1":"2013-02-06","2":"901"},{"1":"2013-02-07","2":"932"},{"1":"2013-02-08","2":"930"},{"1":"2013-02-09","2":"684"},{"1":"2013-02-10","2":"829"},{"1":"2013-02-11","2":"929"},{"1":"2013-02-12","2":"893"},{"1":"2013-02-13","2":"918"},{"1":"2013-02-14","2":"956"},{"1":"2013-02-15","2":"954"},{"1":"2013-02-16","2":"738"},{"1":"2013-02-17","2":"848"},{"1":"2013-02-18","2":"948"},{"1":"2013-02-19","2":"943"},{"1":"2013-02-20","2":"949"},{"1":"2013-02-21","2":"961"},{"1":"2013-02-22","2":"957"},{"1":"2013-02-23","2":"743"},{"1":"2013-02-24","2":"880"},{"1":"2013-02-25","2":"961"},{"1":"2013-02-26","2":"938"},{"1":"2013-02-27","2":"945"},{"1":"2013-02-28","2":"964"},{"1":"2013-03-01","2":"958"},{"1":"2013-03-02","2":"765"},{"1":"2013-03-03","2":"913"},{"1":"2013-03-04","2":"977"},{"1":"2013-03-05","2":"965"},{"1":"2013-03-06","2":"972"},{"1":"2013-03-07","2":"980"},{"1":"2013-03-08","2":"979"},{"1":"2013-03-09","2":"765"},{"1":"2013-03-10","2":"908"},{"1":"2013-03-11","2":"980"},{"1":"2013-03-12","2":"966"},{"1":"2013-03-13","2":"974"},{"1":"2013-03-14","2":"982"},{"1":"2013-03-15","2":"979"},{"1":"2013-03-16","2":"767"},{"1":"2013-03-17","2":"907"},{"1":"2013-03-18","2":"981"},{"1":"2013-03-19","2":"967"},{"1":"2013-03-20","2":"970"},{"1":"2013-03-21","2":"980"},{"1":"2013-03-22","2":"977"},{"1":"2013-03-23","2":"767"},{"1":"2013-03-24","2":"905"},{"1":"2013-03-25","2":"978"},{"1":"2013-03-26","2":"973"},{"1":"2013-03-27","2":"977"},{"1":"2013-03-28","2":"982"},{"1":"2013-03-29","2":"974"},{"1":"2013-03-30","2":"769"},{"1":"2013-03-31","2":"897"},{"1":"2013-04-01","2":"970"},{"1":"2013-04-02","2":"983"},{"1":"2013-04-03","2":"992"},{"1":"2013-04-04","2":"985"},{"1":"2013-04-05","2":"981"},{"1":"2013-04-06","2":"770"},{"1":"2013-04-07","2":"911"},{"1":"2013-04-08","2":"981"},{"1":"2013-04-09","2":"975"},{"1":"2013-04-10","2":"989"},{"1":"2013-04-11","2":"992"},{"1":"2013-04-12","2":"989"},{"1":"2013-04-13","2":"770"},{"1":"2013-04-14","2":"917"},{"1":"2013-04-15","2":"995"},{"1":"2013-04-16","2":"974"},{"1":"2013-04-17","2":"988"},{"1":"2013-04-18","2":"992"},{"1":"2013-04-19","2":"988"},{"1":"2013-04-20","2":"766"},{"1":"2013-04-21","2":"919"},{"1":"2013-04-22","2":"985"},{"1":"2013-04-23","2":"965"},{"1":"2013-04-24","2":"976"},{"1":"2013-04-25","2":"983"},{"1":"2013-04-26","2":"981"},{"1":"2013-04-27","2":"757"},{"1":"2013-04-28","2":"913"},{"1":"2013-04-29","2":"983"},{"1":"2013-04-30","2":"960"},{"1":"2013-05-01","2":"964"},{"1":"2013-05-02","2":"983"},{"1":"2013-05-03","2":"978"},{"1":"2013-05-04","2":"745"},{"1":"2013-05-05","2":"912"},{"1":"2013-05-06","2":"980"},{"1":"2013-05-07","2":"955"},{"1":"2013-05-08","2":"965"},{"1":"2013-05-09","2":"981"},{"1":"2013-05-10","2":"978"},{"1":"2013-05-11","2":"738"},{"1":"2013-05-12","2":"896"},{"1":"2013-05-13","2":"979"},{"1":"2013-05-14","2":"955"},{"1":"2013-05-15","2":"967"},{"1":"2013-05-16","2":"982"},{"1":"2013-05-17","2":"980"},{"1":"2013-05-18","2":"749"},{"1":"2013-05-19","2":"911"},{"1":"2013-05-20","2":"983"},{"1":"2013-05-21","2":"962"},{"1":"2013-05-22","2":"972"},{"1":"2013-05-23","2":"988"},{"1":"2013-05-24","2":"978"},{"1":"2013-05-25","2":"728"},{"1":"2013-05-26","2":"729"},{"1":"2013-05-27","2":"928"},{"1":"2013-05-28","2":"981"},{"1":"2013-05-29","2":"974"},{"1":"2013-05-30","2":"989"},{"1":"2013-05-31","2":"986"},{"1":"2013-06-01","2":"754"},{"1":"2013-06-02","2":"911"},{"1":"2013-06-03","2":"982"},{"1":"2013-06-04","2":"960"},{"1":"2013-06-05","2":"970"},{"1":"2013-06-06","2":"976"},{"1":"2013-06-07","2":"975"},{"1":"2013-06-08","2":"779"},{"1":"2013-06-09","2":"908"},{"1":"2013-06-10","2":"987"},{"1":"2013-06-11","2":"980"},{"1":"2013-06-12","2":"983"},{"1":"2013-06-13","2":"989"},{"1":"2013-06-14","2":"989"},{"1":"2013-06-15","2":"801"},{"1":"2013-06-16","2":"918"},{"1":"2013-06-17","2":"990"},{"1":"2013-06-18","2":"982"},{"1":"2013-06-19","2":"985"},{"1":"2013-06-20","2":"995"},{"1":"2013-06-21","2":"993"},{"1":"2013-06-22","2":"812"},{"1":"2013-06-23","2":"923"},{"1":"2013-06-24","2":"994"},{"1":"2013-06-25","2":"993"},{"1":"2013-06-26","2":"995"},{"1":"2013-06-27","2":"995"},{"1":"2013-06-28","2":"994"},{"1":"2013-06-29","2":"812"},{"1":"2013-06-30","2":"918"},{"1":"2013-07-01","2":"966"},{"1":"2013-07-02","2":"945"},{"1":"2013-07-03","2":"983"},{"1":"2013-07-04","2":"737"},{"1":"2013-07-05","2":"822"},{"1":"2013-07-06","2":"805"},{"1":"2013-07-07","2":"934"},{"1":"2013-07-08","2":"1004"},{"1":"2013-07-09","2":"1001"},{"1":"2013-07-10","2":"1004"},{"1":"2013-07-11","2":"1006"},{"1":"2013-07-12","2":"1002"},{"1":"2013-07-13","2":"811"},{"1":"2013-07-14","2":"931"},{"1":"2013-07-15","2":"999"},{"1":"2013-07-16","2":"996"},{"1":"2013-07-17","2":"1001"},{"1":"2013-07-18","2":"1003"},{"1":"2013-07-19","2":"999"},{"1":"2013-07-20","2":"810"},{"1":"2013-07-21","2":"929"},{"1":"2013-07-22","2":"1000"},{"1":"2013-07-23","2":"997"},{"1":"2013-07-24","2":"1000"},{"1":"2013-07-25","2":"1003"},{"1":"2013-07-26","2":"999"},{"1":"2013-07-27","2":"811"},{"1":"2013-07-28","2":"930"},{"1":"2013-07-29","2":"999"},{"1":"2013-07-30","2":"997"},{"1":"2013-07-31","2":"1001"},{"1":"2013-08-01","2":"1000"},{"1":"2013-08-02","2":"999"},{"1":"2013-08-03","2":"809"},{"1":"2013-08-04","2":"929"},{"1":"2013-08-05","2":"1000"},{"1":"2013-08-06","2":"996"},{"1":"2013-08-07","2":"1001"},{"1":"2013-08-08","2":"1001"},{"1":"2013-08-09","2":"999"},{"1":"2013-08-10","2":"807"},{"1":"2013-08-11","2":"929"},{"1":"2013-08-12","2":"1001"},{"1":"2013-08-13","2":"995"},{"1":"2013-08-14","2":"997"},{"1":"2013-08-15","2":"1000"},{"1":"2013-08-16","2":"998"},{"1":"2013-08-17","2":"780"},{"1":"2013-08-18","2":"914"},{"1":"2013-08-19","2":"996"},{"1":"2013-08-20","2":"986"},{"1":"2013-08-21","2":"990"},{"1":"2013-08-22","2":"990"},{"1":"2013-08-23","2":"989"},{"1":"2013-08-24","2":"774"},{"1":"2013-08-25","2":"903"},{"1":"2013-08-26","2":"982"},{"1":"2013-08-27","2":"965"},{"1":"2013-08-28","2":"973"},{"1":"2013-08-29","2":"979"},{"1":"2013-08-30","2":"965"},{"1":"2013-08-31","2":"680"},{"1":"2013-09-01","2":"718"},{"1":"2013-09-02","2":"929"},{"1":"2013-09-03","2":"956"},{"1":"2013-09-04","2":"948"},{"1":"2013-09-05","2":"969"},{"1":"2013-09-06","2":"967"},{"1":"2013-09-07","2":"688"},{"1":"2013-09-08","2":"908"},{"1":"2013-09-09","2":"991"},{"1":"2013-09-10","2":"961"},{"1":"2013-09-11","2":"947"},{"1":"2013-09-12","2":"992"},{"1":"2013-09-13","2":"996"},{"1":"2013-09-14","2":"686"},{"1":"2013-09-15","2":"900"},{"1":"2013-09-16","2":"992"},{"1":"2013-09-17","2":"961"},{"1":"2013-09-18","2":"972"},{"1":"2013-09-19","2":"992"},{"1":"2013-09-20","2":"994"},{"1":"2013-09-21","2":"693"},{"1":"2013-09-22","2":"904"},{"1":"2013-09-23","2":"993"},{"1":"2013-09-24","2":"960"},{"1":"2013-09-25","2":"976"},{"1":"2013-09-26","2":"996"},{"1":"2013-09-27","2":"996"},{"1":"2013-09-28","2":"682"},{"1":"2013-09-29","2":"914"},{"1":"2013-09-30","2":"993"},{"1":"2013-10-01","2":"965"},{"1":"2013-10-02","2":"975"},{"1":"2013-10-03","2":"995"},{"1":"2013-10-04","2":"995"},{"1":"2013-10-05","2":"687"},{"1":"2013-10-06","2":"917"},{"1":"2013-10-07","2":"994"},{"1":"2013-10-08","2":"964"},{"1":"2013-10-09","2":"974"},{"1":"2013-10-10","2":"994"},{"1":"2013-10-11","2":"991"},{"1":"2013-10-12","2":"676"},{"1":"2013-10-13","2":"902"},{"1":"2013-10-14","2":"987"},{"1":"2013-10-15","2":"963"},{"1":"2013-10-16","2":"974"},{"1":"2013-10-17","2":"995"},{"1":"2013-10-18","2":"993"},{"1":"2013-10-19","2":"684"},{"1":"2013-10-20","2":"915"},{"1":"2013-10-21","2":"991"},{"1":"2013-10-22","2":"964"},{"1":"2013-10-23","2":"975"},{"1":"2013-10-24","2":"992"},{"1":"2013-10-25","2":"989"},{"1":"2013-10-26","2":"685"},{"1":"2013-10-27","2":"910"},{"1":"2013-10-28","2":"983"},{"1":"2013-10-29","2":"965"},{"1":"2013-10-30","2":"973"},{"1":"2013-10-31","2":"922"},{"1":"2013-11-01","2":"986"},{"1":"2013-11-02","2":"689"},{"1":"2013-11-03","2":"902"},{"1":"2013-11-04","2":"978"},{"1":"2013-11-05","2":"967"},{"1":"2013-11-06","2":"973"},{"1":"2013-11-07","2":"991"},{"1":"2013-11-08","2":"986"},{"1":"2013-11-09","2":"715"},{"1":"2013-11-10","2":"895"},{"1":"2013-11-11","2":"983"},{"1":"2013-11-12","2":"973"},{"1":"2013-11-13","2":"976"},{"1":"2013-11-14","2":"988"},{"1":"2013-11-15","2":"985"},{"1":"2013-11-16","2":"714"},{"1":"2013-11-17","2":"896"},{"1":"2013-11-18","2":"985"},{"1":"2013-11-19","2":"973"},{"1":"2013-11-20","2":"977"},{"1":"2013-11-21","2":"1000"},{"1":"2013-11-22","2":"999"},{"1":"2013-11-23","2":"744"},{"1":"2013-11-24","2":"896"},{"1":"2013-11-25","2":"942"},{"1":"2013-11-26","2":"989"},{"1":"2013-11-27","2":"1014"},{"1":"2013-11-28","2":"634"},{"1":"2013-11-29","2":"661"},{"1":"2013-11-30","2":"857"},{"1":"2013-12-01","2":"987"},{"1":"2013-12-02","2":"1004"},{"1":"2013-12-03","2":"973"},{"1":"2013-12-04","2":"958"},{"1":"2013-12-05","2":"969"},{"1":"2013-12-06","2":"970"},{"1":"2013-12-07","2":"691"},{"1":"2013-12-08","2":"875"},{"1":"2013-12-09","2":"962"},{"1":"2013-12-10","2":"943"},{"1":"2013-12-11","2":"954"},{"1":"2013-12-12","2":"968"},{"1":"2013-12-13","2":"970"},{"1":"2013-12-14","2":"692"},{"1":"2013-12-15","2":"880"},{"1":"2013-12-16","2":"964"},{"1":"2013-12-17","2":"949"},{"1":"2013-12-18","2":"956"},{"1":"2013-12-19","2":"974"},{"1":"2013-12-20","2":"980"},{"1":"2013-12-21","2":"811"},{"1":"2013-12-22","2":"895"},{"1":"2013-12-23","2":"985"},{"1":"2013-12-24","2":"761"},{"1":"2013-12-25","2":"719"},{"1":"2013-12-26","2":"936"},{"1":"2013-12-27","2":"963"},{"1":"2013-12-28","2":"814"},{"1":"2013-12-29","2":"888"},{"1":"2013-12-30","2":"968"},{"1":"2013-12-31","2":"776"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>ggplot(daily, aes(date, n)) + 
  geom_line()</code></pre>
<p><img src="Modelacion_files/figure-html/build-3-1.png" width="624" /></p>
</div>
<div id="section-día-de-la-semana" class="section level3">
<h3>Día de la semana</h3>
<p>Comprender la tendencia a largo plazo es un desafío porque hay un efecto de día de la semana muy fuerte que domina los patrones más sutiles. Comencemos observando la distribución de los números de vuelo por día de la semana:</p>
<pre class="r"><code>daily &lt;- daily %&gt;% 
  mutate(wday = wday(date, label = TRUE))

ggplot(daily, aes(wday, n)) + 
  geom_boxplot()</code></pre>
<p><img src="Modelacion_files/figure-html/build-4-1.png" width="624" /></p>
<p>Hay menos vuelos los fines de semana porque la mayoría de los viajes son por negocios. El efecto es particularmente pronunciado el sábado: a veces puede salir el domingo para una reunión del lunes por la mañana, pero es muy raro que se vaya el sábado, ya que preferiría estar en casa con su familia.</p>
<p>Una forma de eliminar este patrón fuerte es usar un modelo. Primero, ajustamos el modelo y mostramos sus predicciones superpuestas a los datos originales:</p>
<pre class="r"><code>mod &lt;- lm(n ~ wday, data = daily)

grid &lt;- daily %&gt;% 
  data_grid(wday) %&gt;% 
  add_predictions(mod, &quot;n&quot;)

ggplot(daily, aes(wday, n)) + 
  geom_boxplot() +
  geom_point(data = grid, colour = &quot;red&quot;, size = 4)</code></pre>
<p><img src="Modelacion_files/figure-html/build-5-1.png" width="624" /></p>
<p>A continuación, calculamos y visualizamos los residuos:</p>
<pre class="r"><code>daily &lt;- daily %&gt;% 
  add_residuals(mod)
daily %&gt;% 
  ggplot(aes(date, resid)) + 
  geom_ref_line(h = 0) + 
  geom_line()</code></pre>
<p><img src="Modelacion_files/figure-html/build-6-1.png" width="624" /></p>
<p>Observa el cambio en el eje <code>y</code>: ahora estamos viendo la desviación del número esperado de vuelos, dado el día de la semana. Esta gráfica es útil porque ahora que hemos eliminado gran parte del gran efecto del día de la semana, podemos ver algunos de los patrones más sutiles que quedan:</p>
<ul>
<li>1 - Nuestro modelo parece fallar a partir de junio: todavía puede ver un patrón regular fuerte que nuestro modelo no ha capturado. Dibujar una gráfica de línea para cada día de la semana hace que la causa sea más fácil de ver:</li>
</ul>
<pre class="r"><code>  ggplot(daily, aes(date, resid, colour = wday)) + 
  geom_ref_line(h = 0) + 
  geom_line()</code></pre>
<p><img src="Modelacion_files/figure-html/build-7-1.png" width="624" /></p>
<ul>
<li><p>Nuestro modelo no puede predecir con precisión la cantidad de vuelos el sábado: durante el verano hay más vuelos de los que esperamos y durante el otoño hay menos. Veremos cómo podemos mejorar para capturar este patrón en la siguiente sección.</p></li>
<li><p>2 - Hay algunos días con muchos menos vuelos de los esperados:</p></li>
</ul>
<pre class="r"><code>daily %&gt;% 
  filter(resid &lt; -100)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["date"],"name":[1],"type":["date"],"align":["right"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]},{"label":["wday"],"name":[3],"type":["ord"],"align":["right"]},{"label":["resid"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"2013-01-01","2":"842","3":"mar","4":"-109.3585"},{"1":"2013-01-20","2":"786","3":"dom","4":"-105.4808"},{"1":"2013-05-26","2":"729","3":"dom","4":"-162.4808"},{"1":"2013-07-04","2":"737","3":"jue","4":"-228.7500"},{"1":"2013-07-05","2":"822","3":"vie","4":"-145.4615"},{"1":"2013-09-01","2":"718","3":"dom","4":"-173.4808"},{"1":"2013-11-28","2":"634","3":"jue","4":"-331.7500"},{"1":"2013-11-29","2":"661","3":"vie","4":"-306.4615"},{"1":"2013-12-24","2":"761","3":"mar","4":"-190.3585"},{"1":"2013-12-25","2":"719","3":"mié","4":"-243.6923"},{"1":"2013-12-31","2":"776","3":"mar","4":"-175.3585"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<ul>
<li><p>Si estás familiarizado con los días festivos estadounidenses, puedes ver el día de Año Nuevo, el 4 de julio, el Día de Acción de Gracias y la Navidad. Hay otros que no parecen corresponder a festivos. Trabajarás en ellos en uno de los ejercicios.</p></li>
<li><p>3 - Parece haber una tendencia a largo plazo más suave en el transcurso de un año. Podemos resaltar esa tendencia con <code>geom_smooth()</code>:</p></li>
</ul>
<pre class="r"><code>  daily %&gt;% 
  ggplot(aes(date, resid)) + 
  geom_ref_line(h = 0) + 
  geom_line(colour = &quot;grey50&quot;) + 
  geom_smooth(se = FALSE, span = 0.20)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="Modelacion_files/figure-html/build-9-1.png" width="624" /></p>
<p>Hay menos vuelos en enero (y diciembre) y más en verano (mayo-septiembre). No podemos hacer mucho con este patrón cuantitativamente, porque solo tenemos un año de datos.</p>
<p>Pero podemos usar nuestro conocimiento del dominio para generar una lluvia de ideas sobre posibles explicaciones.</p>
</div>
<div id="section-efecto-sábado-estacional" class="section level3">
<h3>Efecto sábado estacional</h3>
<p>Primero, abordemos nuestro fracaso en predecir con precisión la cantidad de vuelos el sábado. Un buen lugar para comenzar es volver a los números brutos, centrándose en los sábados:</p>
<pre class="r"><code>daily %&gt;% 
  filter(wday == &quot;sáb&quot;) %&gt;% 
  ggplot(aes(date, n)) + 
    geom_point() + 
    geom_line() +
    scale_x_date(NULL, date_breaks = &quot;1 month&quot;, date_labels = &quot;%b&quot;)</code></pre>
<p><img src="Modelacion_files/figure-html/build-10-1.png" width="624" /></p>
<p>(Hemos utilizado puntos y líneas para aclarar qué son datos y qué es interpolación).</p>
<p>Se sospecha que este patrón se debe a las vacaciones de verano: mucha gente se va de vacaciones en verano y no le importa viajar los sábados por vacaciones. Mirando esta gráfica, podríamos suponer que las vacaciones de verano son desde principios de junio hasta finales de agosto.</p>
<p>Eso parece coincidir bastante bien con los términos escolares del estado: las vacaciones de verano en 2013 fueron del 26 de junio al 9 de septiembre.</p>
<p>¿Por qué hay más vuelos los sábados en primavera que en otoño? Le pregunté a algunos amigos estadounidenses y me sugirieron que es menos común planificar las vacaciones familiares durante el otoño debido a las grandes fiestas de Acción de Gracias y Navidad. No tenemos los datos para saberlo con certeza, pero parece una hipótesis de trabajo plausible.</p>
<p>Creemos una variable de “término” que capture aproximadamente los tres términos escolares y verifiquemos nuestro trabajo con una gráfica:</p>
<pre class="r"><code>term &lt;- function(date) {
  cut(date, 
    breaks = ymd(20130101, 20130605, 20130825, 20140101),
    labels = c(&quot;primavera&quot;, &quot;verano&quot;, &quot;otoño&quot;) 
  )
}

daily &lt;- daily %&gt;% 
  mutate(term = term(date)) 

daily %&gt;% 
  filter(wday == &quot;sáb&quot;) %&gt;% 
  ggplot(aes(date, n, colour = term)) +
  geom_point(alpha = 1/3) + 
  geom_line() +
  scale_x_date(NULL, date_breaks = &quot;1 month&quot;, date_labels = &quot;%b&quot;)</code></pre>
<p><img src="Modelacion_files/figure-html/build-11-1.png" width="624" /></p>
<p>(Modificamos manualmente las fechas para obtener buenos descansos en la gráfica.</p>
<p>Usar una visualización para ayudarte a comprender lo que está haciendo tu función es una técnica muy poderosa y general).</p>
<p>Es útil ver cómo esta nueva variable afecta a los otros días de la semana:</p>
<pre class="r"><code>daily %&gt;% 
  ggplot(aes(wday, n, colour = term)) +
    geom_boxplot()</code></pre>
<p><img src="Modelacion_files/figure-html/build-12-1.png" width="624" /></p>
<p>Parece que hay una variación significativa entre los términos, por lo que es razonable ajustar un efecto de día de la semana por separado para cada término. Esto mejora nuestro modelo, pero no tanto como podríamos esperar:</p>
<pre class="r"><code>mod1 &lt;- lm(n ~ wday, data = daily)
mod2 &lt;- lm(n ~ wday * term, data = daily)

daily %&gt;% 
  gather_residuals(without_term = mod1, with_term = mod2) %&gt;% 
  ggplot(aes(date, resid, colour = model)) +
    geom_line(alpha = 0.75)</code></pre>
<p><img src="Modelacion_files/figure-html/build-122-1.png" width="624" /></p>
<p>Nuestro modelo está encontrando el efecto medio, pero tenemos muchos valores atípicos importantes, por lo que la media tiende a estar muy lejos del valor típico.</p>
<p>Podemos aliviar este problema utilizando un modelo que sea robusto al efecto de valores atípicos: <code>MASS::rlm()</code>. Esto reduce en gran medida el impacto de los valores atípicos en nuestras estimaciones y proporciona un modelo que hace un buen trabajo al eliminar el patrón del día de la semana:</p>
<pre class="r"><code>mod3 &lt;- MASS::rlm(n ~ wday * term, data = daily)

daily %&gt;% 
  add_residuals(mod3, &quot;resid&quot;) %&gt;% 
  ggplot(aes(date, resid)) + 
  geom_hline(yintercept = 0, size = 2, colour = &quot;white&quot;) + 
  geom_line()</code></pre>
<p><img src="Modelacion_files/figure-html/build-13-1.png" width="624" /></p>
<p>Ahora es mucho más fácil ver la tendencia a largo plazo y los valores atípicos positivos y negativos.</p>
</div>
<div id="section-variables-calculadas" class="section level3">
<h3>Variables calculadas</h3>
<p>Si está experimentando con muchos modelos y muchas visualizaciones, es una buena idea agrupar la creación de variables en una función para que no haya posibilidad de aplicar accidentalmente una transformación diferente en diferentes lugares. Por ejemplo, podríamos escribir:</p>
<pre class="r"><code>compute_vars &lt;- function(data) {
  data %&gt;% 
    mutate(
      term = term(date), 
      wday = wday(date, label = TRUE)
    )
}</code></pre>
<p>Otra opción es poner las transformaciones directamente en la fórmula del modelo:</p>
<pre class="r"><code>wday2 &lt;- function(x) wday(x, label = TRUE)
mod3 &lt;- lm(n ~ wday2(date) * term(date), data = daily)</code></pre>
<p>Cualquiera de los dos enfoques es razonable. Hacer explícita la variable transformada es útil si desea verificar su trabajo o usarlos en una visualización. Pero no puede usar fácilmente transformaciones (como splines) que devuelven varias columnas. Incluir las transformaciones en la función del modelo facilita un poco la vida cuando se trabaja con muchos conjuntos de datos diferentes porque el modelo es autónomo.</p>
</div>
<div id="section-época-del-año-un-enfoque-alternativo" class="section level3">
<h3>Época del año: un enfoque alternativo</h3>
<p>En la sección anterior usamos nuestro conocimiento de dominio (cómo el período escolar de EE. UU. Afecta los viajes) para mejorar el modelo. Una alternativa a utilizar nuestro conocimiento explícitamente en el modelo es dar a los datos más espacio para hablar. Podríamos usar un modelo más flexible y permitir que capture el patrón que nos interesa. Una tendencia lineal simple no es adecuada, por lo que podríamos intentar usar una spline natural para ajustar una curva suave a lo largo del año:</p>
<pre class="r"><code>library(splines)
mod &lt;- MASS::rlm(n ~ wday * ns(date, 5), data = daily)

daily %&gt;% 
  data_grid(wday, date = seq_range(date, n = 13)) %&gt;% 
  add_predictions(mod) %&gt;% 
  ggplot(aes(date, pred, colour = wday)) + 
    geom_line() +
    geom_point()</code></pre>
<p><img src="Modelacion_files/figure-html/build-15-1.png" width="624" /></p>
<p>Vemos un patrón fuerte en el número de vuelos de los sábados. Esto es tranquilizador, porque también vimos ese patrón en los datos sin procesar. Es una buena señal cuando recibe la misma señal desde diferentes enfoques.</p>
</div>
<div id="section-aprende-más-sobre-los-modelos" class="section level3">
<h3>Aprende más sobre los modelos</h3>
<p>Solo hemos arañado la superficie absoluta del modelado, pero esperamos que haya obtenido algunas herramientas simples pero de propósito general que puede usar para mejorar sus propios análisis de datos. ¡Está bien empezar de forma sencilla! Como has visto, incluso los modelos muy simples pueden marcar una diferencia dramática en su capacidad para descubrir interacciones entre variables.</p>
<p>Me acerco al modelado desde una perspectiva algo diferente a la mayoría de los demás, y se le dedica relativamente poco espacio. El modelaje realmente merece un curso por sí solo, por lo que le recomiendo que lea al menos uno de estos tres libros:</p>
<ul>
<li><p><strong>Modelado estadístico</strong>: un nuevo enfoque de Danny Kaplan, <a href="http://project-mosaic-books.com/?page_id=13" class="uri">http://project-mosaic-books.com/?page_id=13</a>. Este libro proporciona una suave introducción al modelado, donde desarrolla su intuición, herramientas matemáticas y habilidades de R en paralelo. El libro reemplaza un curso tradicional de “introducción a la estadística”, proporcionando un plan de estudios actualizado y relevante para la ciencia de datos.</p></li>
<li><p><strong>Una introducción al aprendizaje estadístico</strong>: de Gareth James, Daniela Witten, Trevor Hastie y Robert Tibshirani, <a href="http://www-bcf.usc.edu/~gareth/ISL/" class="uri">http://www-bcf.usc.edu/~gareth/ISL/</a> (disponible en línea de forma gratuita). Este libro presenta una familia de técnicas de modelado modernas conocidas colectivamente como aprendizaje estadístico. Para una comprensión aún más profunda de las matemáticas detrás de los modelos, lea el clásico Elementos de aprendizaje estadístico de Trevor Hastie, Robert Tibshirani y Jerome Friedman, <a href="https://web.stanford.edu/~hastie/Papers/ESLII.pdf" class="uri">https://web.stanford.edu/~hastie/Papers/ESLII.pdf</a> (también disponible en línea de forma gratuita).</p></li>
<li><p><strong>Modelado predictivo aplicado</strong> : de Max Kuhn y Kjell Johnson, <a href="http://appliedpredictivemodeling.com" class="uri">http://appliedpredictivemodeling.com</a>. Este libro es un complemento del paquete de intercalaciones y proporciona herramientas prácticas para abordar los desafíos del modelado predictivo de la vida real.</p></li>
</ul>
</div>
<div id="section-ejercicios-3" class="section level3">
<h3>Ejercicios</h3>
<ul>
<li><p>1 - Use sus habilidades de investigación de Google para pensar en por qué hubo menos vuelos de los esperados el 20 de enero, el 26 de mayo y el 1 de septiembre. (Pista: todos tienen la misma explicación). ¿Cómo se generalizarían estos días a otro año?</p></li>
<li><p>2 - ¿Qué representan los tres días con altos residuos positivos? ¿Cómo se generalizarían estos días a otro año?</p></li>
</ul>
<pre class="r"><code>daily %&gt;% 
  slice_max(n = 3, resid)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["date"],"name":[1],"type":["date"],"align":["right"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]},{"label":["wday"],"name":[3],"type":["ord"],"align":["right"]},{"label":["resid"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["term"],"name":[5],"type":["fct"],"align":["left"]}],"data":[{"1":"2013-11-30","2":"857","3":"sáb","4":"112.38462","5":"otoño"},{"1":"2013-12-01","2":"987","3":"dom","4":"95.51923","5":"otoño"},{"1":"2013-12-28","2":"814","3":"sáb","4":"69.38462","5":"otoño"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<ul>
<li><p>3 - Crea una nueva variable que divida la variable <code>wday</code> en términos, pero solo para los sábados, es decir, debería tener <code>jue</code>, <code>vie</code>, pero <code>sáb-verano</code>, <code>sáb-primavera</code>, <code>sáb-otoño</code>. ¿Cómo se compara este modelo con el modelo con cada combinación de <code>wday</code> y <code>term</code>?</p></li>
<li><p>4- Crea una nueva variable <code>wday</code> que combine el día de la semana, el plazo (para los sábados) y los días festivos. ¿Cómo se ven los residuos de ese modelo?</p></li>
<li><p>5 - ¿Qué sucede si ajusta un efecto de día de la semana que varía según el mes (es decir, <code>n ~ wday * month</code>)? ¿Por qué esto no es muy útil?</p></li>
<li><p>6 - ¿Cómo esperaría que se vea el modelo <code>n ~ wday + ns(date, 5)</code>? Sabiendo lo que sabe sobre los datos, ¿por qué esperaría que no fueran particularmente efectivos?</p></li>
<li><p>7 - Presumimos que las personas que se van los domingos tienen más probabilidades de ser viajeros de negocios que necesitan estar en algún lugar el lunes. Explore esa hipótesis al ver cómo se descompone en función de la distancia y el tiempo: si es cierto, esperaría ver más vuelos los domingos por la noche a lugares que están lejos.</p></li>
<li><p>8 - Es un poco frustrante que el domingo y el sábado estén en extremos separados de la trama. Escribe una pequeña función para establecer los niveles del factor para que la semana comience el lunes.</p></li>
</ul>
</div>
</div>
<div id="section-enviar-ejercicios" class="section level2">
<h2>Enviar Ejercicios</h2>
<div id="section-material-de-referencia" class="section level3">
<h3>Material de referencia</h3>
<p>Hadley Wickham y Garrett Grolemund, “R for Data Science: Import, Tidy, Transform, Visualize, and Model Data” O’REILLY <a href="https://r4ds.had.co.nz/"><code>R for Data Science</code></a></p>
<div class="encoder_ui">
<div>
Si ha completado este tutorial y está satisfecho con todos sus
soluciones, haga clic en el botón de abajo para generar su hash y
envíalo usando el siguiente formulario:
<br/>
</div>
<div class="row" style="padding-bottom: 0.5em;">
<div class="col-sm-3">
<button id="hash_generate" type="button" class="btn btn-default action-button" title="Generate hash">Generate</button>
</div>
<div class="col-sm-7"></div>
<div class="col-sm-2">
<div class="btn-group btn-group-sm pull-right" role="group" aria-label="Clipboard buttons">
<button id="hash_select" class="btn btn-default" type="button" title="Select hash"><svg
      aria-hidden="true" focusable="false"
      data-prefix="fas" data-icon="i-cursor"
      class="svg-inline--fa fa-i-cursor fa-w-8"
      role="img" xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 256 512" style="height: 16px;">
      <path fill="currentColor" d="M256 52.048V12.065C256 5.496 250.726.148 244.158.066 211.621-.344 166.469.011 128 37.959 90.266.736 46.979-.114 11.913.114 5.318.157 0 5.519 0 12.114v39.645c0 6.687 5.458 12.078 12.145 11.998C38.111 63.447 96 67.243 96 112.182V224H60c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h36v112c0 44.932-56.075 48.031-83.95 47.959C5.404 447.942 0 453.306 0 459.952v39.983c0 6.569 5.274 11.917 11.842 11.999 32.537.409 77.689.054 116.158-37.894 37.734 37.223 81.021 38.073 116.087 37.845 6.595-.043 11.913-5.405 11.913-12V460.24c0-6.687-5.458-12.078-12.145-11.998C217.889 448.553 160 444.939 160 400V288h36c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12h-36V112.182c0-44.932 56.075-48.213 83.95-48.142 6.646.018 12.05-5.346 12.05-11.992z">
      </path>
    </svg></button>
<span class="btn-separator"></span>
<button id="hash_copy" class="btn btn-default" type="button" title="Copy hash to clipboard"><svg
      aria-hidden="true" focusable="false"
      data-prefix="far" data-icon="clipboard"
      class="svg-inline--fa fa-clipboard fa-w-12"
      role="img" xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 384 512" style="height: 16px;">
      <path fill="currentColor" d="M336 64h-80c0-35.3-28.7-64-64-64s-64 28.7-64 64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM192 40c13.3 0 24 10.7 24 24s-10.7 24-24 24-24-10.7-24-24 10.7-24 24-24zm144 418c0 3.3-2.7 6-6 6H54c-3.3 0-6-2.7-6-6V118c0-3.3 2.7-6 6-6h42v36c0 6.6 5.4 12 12 12h168c6.6 0 12-5.4 12-12v-36h42c3.3 0 6 2.7 6 6z">
      </path>
    </svg></button>
</div>
</div>
</div>
<pre id="hash_output" class="shiny-text-output" style="white-space: pre-wrap;"></pre>
<br/>
<script>selectText = function(node) {
        node = document.getElementById(node);

        if (document.body.createTextRange) {
          const range = document.body.createTextRange();
          range.moveToElementText(node);
          range.select();
        } else if (window.getSelection) {
          const selection = window.getSelection();
          const range = document.createRange();
          range.selectNodeContents(node);
          selection.removeAllRanges();
          selection.addRange(range);
        } else {
          console.warn('Could not select text in node: Unsupported browser.');
        }
      }</script>
<script>document.getElementById('hash_select').addEventListener('click', function(e) {
        e.preventDefault();

        selectText('hash_output');
      });</script>
<script>document.getElementById('hash_copy').addEventListener('click', function(e) {
        e.preventDefault();

        selectText('hash_output');
        document.execCommand('copy');
      });</script>
</div>
<p>Enviar hash al siguiente link -&gt; <a href="https://docs.google.com/spreadsheets/d/1eXNEGrumywfCt4xop5ygcJGxbXI5kfNdiHOztiGspoA/edit?usp=sharing"><strong>Aqui</strong></a></p>
<p><img src="images/morant.jpg" /><!-- --></p>

<script type="application/shiny-prerendered" data-context="server-start">
library(learnr)
library(gradethis)
library(learnrhash)
library(tidyverse)
library(ggplot2)
require("maps")
gradethis::gradethis_setup()
knitr::opts_chunk$set(exercise.checker = gradethis::grade_learnr)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::register_http_handlers(session, metadata = list(id = "morant-clase-5", version = 1L))
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::clear_exercise_cache_env()
</script>
 
<script type="application/shiny-prerendered" data-context="server">
session$onSessionEnded(function() {
        learnr:::event_trigger(session, "session_stop")
      })
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_setup_chunk("__setup__", c("library(learnr)", "library(gradethis)", "library(learnrhash)", 
"library(tidyverse)", "library(ggplot2)", "require(\"maps\")", 
"gradethis::gradethis_setup()", "knitr::opts_chunk$set(exercise.checker = gradethis::grade_learnr)"
), overwrite = FALSE)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_setup_chunk("__setup__", c("library(learnr)", "library(gradethis)", "library(learnrhash)", 
"library(tidyverse)", "library(ggplot2)", "require(\"maps\")", 
"gradethis::gradethis_setup()", "knitr::opts_chunk$set(exercise.checker = gradethis::grade_learnr)"
), overwrite = FALSE)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_setup_chunk("__setup__", c("library(learnr)", "library(gradethis)", "library(learnrhash)", 
"library(tidyverse)", "library(ggplot2)", "require(\"maps\")", 
"gradethis::gradethis_setup()", "knitr::opts_chunk$set(exercise.checker = gradethis::grade_learnr)"
), overwrite = FALSE)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::store_exercise_setup_chunk("__setup__", c("library(learnr)", "library(gradethis)", "library(learnrhash)", 
"library(tidyverse)", "library(ggplot2)", "require(\"maps\")", 
"gradethis::gradethis_setup()", "knitr::opts_chunk$set(exercise.checker = gradethis::grade_learnr)"
), overwrite = FALSE)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnrhash::encoder_logic()
</script>
 <!--html_preserve-->
<script type="application/shiny-prerendered" data-context="dependencies">
{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["1.11.3"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/jquery"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.9"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bootstrap"]},{"type":"character","attributes":{},"value":["3.3.5"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/bootstrap"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["viewport"]}},"value":[{"type":"character","attributes":{},"value":["width=device-width, initial-scale=1"]}]},{"type":"character","attributes":{},"value":["js/bootstrap.min.js","shim/html5shiv.min.js","shim/respond.min.js"]},{"type":"character","attributes":{},"value":["css/cerulean.min.css"]},{"type":"character","attributes":{},"value":["<style>h1 {font-size: 34px;}\n       h1.title {font-size: 38px;}\n       h2 {font-size: 30px;}\n       h3 {font-size: 24px;}\n       h4 {font-size: 18px;}\n       h5 {font-size: 16px;}\n       h6 {font-size: 12px;}\n       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}\n       pre:not([class]) { background-color: white }<\/style>"]},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.9"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["pagedtable"]},{"type":"character","attributes":{},"value":["1.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/pagedtable-1.1"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/pagedtable.js"]},{"type":"character","attributes":{},"value":["css/pagedtable.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.9"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["highlightjs"]},{"type":"character","attributes":{},"value":["9.12.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/highlightjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["highlight.js"]},{"type":"character","attributes":{},"value":["textmate.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.9"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial"]},{"type":"character","attributes":{},"value":["0.10.1.9009"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/tutorial"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial.js"]},{"type":"character","attributes":{},"value":["tutorial.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.10.1.9009"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial-autocompletion"]},{"type":"character","attributes":{},"value":["0.10.1.9009"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/tutorial"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial-autocompletion.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.10.1.9009"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial-diagnostics"]},{"type":"character","attributes":{},"value":["0.10.1.9009"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/tutorial"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial-diagnostics.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.10.1.9009"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["i18n"]},{"type":"character","attributes":{},"value":["1.2.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/i18n"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["i18next.min.js","tutorial-i18n-init.js"]},{"type":"NULL"},{"type":"character","attributes":{},"value":["<script id=\"i18n-cstm-trns\" type=\"application/json\">{\"language\":\"en\",\"resources\":{\"en\":{\"translation\":{\"button\":{\"runcode\":\"Run Code\",\"runcodetitle\":\"$t(button.runcode) ({{kbd}})\",\"hint\":\"Hint\",\"hint_plural\":\"Hints\",\"hinttitle\":\"$t(button.hint)\",\"hintnext\":\"Next Hint\",\"hintprev\":\"Previous Hint\",\"solution\":\"Solution\",\"solutiontitle\":\"$t(button.solution)\",\"copyclipboard\":\"Copy to Clipboard\",\"startover\":\"Start Over\",\"startovertitle\":\"$t(button.startover)\",\"continue\":\"Continue\",\"submitanswer\":\"Submit Answer\",\"submitanswertitle\":\"$t(button.submitanswer)\",\"previoustopic\":\"Previous Topic\",\"nexttopic\":\"Next Topic\",\"questionsubmit\":\"$t(button.submitanswer)\",\"questiontryagain\":\"Try Again\"},\"text\":{\"startover\":\"Start Over\",\"areyousure\":\"Are you sure you want to start over? (all exercise progress will be reset)\",\"youmustcomplete\":\"You must complete the\",\"exercise\":\"exercise\",\"exercise_plural\":\"exercises\",\"inthissection\":\"in this section before continuing.\",\"code\":\"Code\",\"enginecap\":\"{{engine}} $t(text.code)\",\"quiz\":\"Quiz\"}}},\"fr\":{\"translation\":{\"button\":{\"runcode\":\"Lancer le Code\",\"runcodetitle\":\"$t(button.runcode) ({{kbd}})\",\"hint\":\"Indication\",\"hint_plural\":\"Indications\",\"hinttitle\":\"$t(button.hint)\",\"hintnext\":\"Indication Suivante\",\"hintprev\":\"Indication Précédente\",\"solution\":\"Solution\",\"solutiontitle\":\"$t(button.solution)\",\"copyclipboard\":\"Copier dans le Presse-papier\",\"startover\":\"Recommencer\",\"startovertitle\":\"$t(button.startover)\",\"continue\":\"Continuer\",\"submitanswer\":\"Soumettre\",\"submitanswertitle\":\"$t(button.submitanswer)\",\"previoustopic\":\"Chapitre Précédent\",\"nexttopic\":\"Chapitre Suivant\",\"questionsubmit\":\"$t(button.submitanswer)\",\"questiontryagain\":\"Réessayer\"},\"text\":{\"startover\":\"Recommencer\",\"areyousure\":\"Êtes-vous certains de vouloir recommencer? (La progression sera remise à zéro)\",\"youmustcomplete\":\"Vous devez d'abord compléter\",\"exercise\":\"l'exercice\",\"exercise_plural\":\"des exercices\",\"inthissection\":\"de cette section avec de continuer.\",\"code\":\"Code\",\"enginecap\":\"$t(text.code) {{engine}}\",\"quiz\":\"Quiz\"}}},\"es\":{\"translation\":{\"button\":{\"runcode\":\"Ejecutar código\",\"runcodetitle\":\"$t(button.runcode) ({{kbd}})\",\"hint\":\"Pista\",\"hint_plural\":\"Pistas\",\"hinttitle\":\"$t(button.hint)\",\"hintnext\":\"Siguiente pista\",\"hintprev\":\"Pista anterior\",\"solution\":\"Solución\",\"solutiontitle\":\"$t(button.solution)\",\"copyclipboard\":\"Copiar al portapapeles\",\"startover\":\"Reiniciar\",\"startovertitle\":\"$t(button.startover)\",\"continue\":\"Continuar\",\"submitanswer\":\"Enviar respuesta\",\"submitanswertitle\":\"$t(button.submitanswer)\",\"previoustopic\":\"Tema anterior\",\"nexttopic\":\"Tema siguiente\",\"questionsubmit\":\"$t(button.submitanswer)\",\"questiontryagain\":\"Volver a intentar\"},\"text\":{\"startover\":\"Reiniciar\",\"areyousure\":\"¿De verdad quieres empezar de nuevo? (todo el progreso del ejercicio se perderá)\",\"youmustcomplete\":\"Debes completar\",\"exercise\":\"el ejercicio\",\"exercise_plural\":\"los ejercicios\",\"inthissection\":\"en esta sección antes de continuar.\",\"code\":\"Código\",\"enginecap\":\"$t(text.code) {{engine}}\",\"quiz\":\"Cuestionario\"}}},\"pt\":{\"translation\":{\"button\":{\"runcode\":\"Executar código\",\"runcodetitle\":\"$t(button.runcode) ({{kbd}})\",\"hint\":\"Dica\",\"hint_plural\":\"Dicas\",\"hinttitle\":\"$t(button.hint)\",\"hintnext\":\"Próxima dica\",\"hintprev\":\"Dica anterior\",\"solution\":\"Solução\",\"solutiontitle\":\"$t(button.solution)\",\"copyclipboard\":\"Copiar para a área de transferência\",\"startover\":\"Reiniciar\",\"startovertitle\":\"$t(button.startover)\",\"continue\":\"Continuar\",\"submitanswer\":\"Enviar resposta\",\"submitanswertitle\":\"$t(button.submitanswer)\",\"previoustopic\":\"Tópico anterior\",\"nexttopic\":\"Próximo tópico\",\"questionsubmit\":\"$t(button.submitanswer)\",\"questiontryagain\":\"Tentar novamente\"},\"text\":{\"startover\":\"Reiniciar\",\"areyousure\":\"Tem certeza que deseja começar novamente? (todo o progresso feito será perdido)\",\"youmustcomplete\":\"Você deve completar\",\"exercise\":\"o exercício\",\"exercise_plural\":\"os exercícios\",\"inthissection\":\"nesta seção antes de continuar.\",\"code\":\"Código\",\"enginecap\":\"$t(text.code) {{engine}}\",\"quiz\":\"Quiz\"}}},\"tr\":{\"translation\":{\"button\":{\"runcode\":\"Çalıştırma Kodu\",\"runcodetitle\":\"$t(button.runcode) ({{kbd}})\",\"hint\":\"Ipucu\",\"hint_plural\":\"İpuçları\",\"hinttitle\":\"$t(button.hint)\",\"hintnext\":\"Sonraki İpucu\",\"hintprev\":\"Önceki İpucu\",\"solution\":\"Çözüm\",\"solutiontitle\":\"$t(button.solution)\",\"copyclipboard\":\"Pano'ya Kopyala\",\"startover\":\"Baştan Başlamak\",\"startovertitle\":\"$t(button.startover)\",\"continue\":\"Devam et\",\"submitanswer\":\"Cevabı onayla\",\"submitanswertitle\":\"$t(button.submitanswer)\",\"previoustopic\":\"Önceki Konu\",\"nexttopic\":\"Sonraki Konu\",\"questionsubmit\":\"$t(button.submitanswer)\",\"questiontryagain\":\"Tekrar Deneyin\"},\"text\":{\"startover\":\"Baştan Başlamak\",\"areyousure\":\"Baştan başlamak istediğinizden emin misiniz? (tüm egzersiz ilerlemesi kaybolacak)\",\"youmustcomplete\":\"Tamamlamalısın\",\"exercise\":\"egzersiz\",\"exercise_plural\":\"egzersizler\",\"inthissection\":\"devam etmeden önce bu bölümde\",\"code\":\"Kod\",\"enginecap\":\"$t(text.code) {{engine}}\",\"quiz\":\"Sınav\"}}},\"emo\":{\"translation\":{\"button\":{\"runcode\":\"🏃\",\"runcodetitle\":\"$t(button.runcode) ({{kbd}})\",\"hint\":\"💡\",\"hint_plural\":\"$t(button.hint)\",\"hinttitle\":\"$t(button.hint)\",\"solution\":\"🎯\",\"solutiontitle\":\"$t(button.solution)\",\"copyclipboard\":\"📋\",\"startover\":\"⏮\",\"startovertitle\":\"Start Over\",\"continue\":\"✅\",\"submitanswer\":\"🆗\",\"submitanswertitle\":\"Submit Answer\",\"previoustopic\":\"⬅\",\"nexttopic\":\"➡\",\"questionsubmit\":\"$t(button.submitanswer)\",\"questiontryagain\":\"🔁\"},\"text\":{\"startover\":\"⏮\",\"areyousure\":\"🤔\",\"youmustcomplete\":\"⚠️ 👉 🧑‍💻\",\"exercise\":\"\",\"exercise_plural\":\"\",\"inthissection\":\"\",\"code\":\"💻\",\"enginecap\":\"$t(text.code) {{engine}}\"}}},\"eu\":{\"translation\":{\"button\":{\"runcode\":\"Kodea egikaritu\",\"runcodetitle\":\"$t(button.runcode) ({{kbd}})\",\"hint\":\"Laguntza\",\"hint_plural\":\"Laguntza\",\"hinttitle\":\"$t(button.hint)\",\"hintnext\":\"Aurreko laguntza\",\"hintprev\":\"Hurrengo laguntza\",\"solution\":\"Ebazpena\",\"solutiontitle\":\"$t(button.solution)\",\"copyclipboard\":\"Arbelean kopiatu\",\"startover\":\"Berrabiarazi\",\"startovertitle\":\"$t(button.startover)\",\"continue\":\"Jarraitu\",\"submitanswer\":\"Erantzuna bidali\",\"submitanswertitle\":\"$t(button.submitanswer)\",\"previoustopic\":\"Aurreko atala\",\"nexttopic\":\"Hurrengo atala\",\"questionsubmit\":\"$t(button.submitanswer)\",\"questiontryagain\":\"Berriro saiatu\"},\"text\":{\"startover\":\"Berrabiarazi\",\"areyousure\":\"Berriro hasi nahi duzu? (egindako lana galdu egingo da)\",\"youmustcomplete\":\"Aurrera egin baino lehen atal honetako\",\"exercise\":\"ariketa egin behar duzu.\",\"exercise_plural\":\"ariketak egin behar dituzu.\",\"inthissection\":\"\",\"code\":\"Kodea\",\"enginecap\":\"$t(text.code) {{engine}}\",\"quiz\":\"Galdetegia\"}}}}}<\/script>"]},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.10.1.9009"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial-format"]},{"type":"character","attributes":{},"value":["0.10.1.9009"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmarkdown/templates/tutorial/resources"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial-format.js"]},{"type":"character","attributes":{},"value":["tutorial-format.css","rstudio-theme.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.10.1.9009"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["1.11.3"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/jquery"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.9"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["navigation"]},{"type":"character","attributes":{},"value":["1.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/navigation-1.1"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tabsets.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.9"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["highlightjs"]},{"type":"character","attributes":{},"value":["9.12.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/highlightjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["highlight.js"]},{"type":"character","attributes":{},"value":["default.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.9"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["1.11.3"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/jquery"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.9"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["font-awesome"]},{"type":"character","attributes":{},"value":["5.1.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/fontawesome"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["css/all.css","css/v4-shims.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.9"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bootbox"]},{"type":"character","attributes":{},"value":["4.4.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/bootbox"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["bootbox.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.10.1.9009"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["idb-keyvalue"]},{"type":"character","attributes":{},"value":["3.2.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/idb-keyval"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["idb-keyval-iife-compat.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["0.10.1.9009"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial"]},{"type":"character","attributes":{},"value":["0.10.1.9009"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/tutorial"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial.js"]},{"type":"character","attributes":{},"value":["tutorial.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.10.1.9009"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial-autocompletion"]},{"type":"character","attributes":{},"value":["0.10.1.9009"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/tutorial"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial-autocompletion.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.10.1.9009"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial-diagnostics"]},{"type":"character","attributes":{},"value":["0.10.1.9009"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/tutorial"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial-diagnostics.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.10.1.9009"]}]}]}
</script>
<!--/html_preserve-->
<!--html_preserve-->
<script type="application/shiny-prerendered" data-context="execution_dependencies">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages","version"]},"class":{"type":"character","attributes":{},"value":["data.frame"]},"row.names":{"type":"integer","attributes":{},"value":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96]}},"value":[{"type":"character","attributes":{},"value":["assertthat","backports","base","broom","bslib","cellranger","checkmate","cli","colorspace","compiler","crayon","curl","datasets","DBI","dbplyr","digest","dplyr","ellipsis","evaluate","fansi","farver","fastmap","forcats","fs","generics","ggplot2","glue","gradethis","graphics","grDevices","grid","gtable","haven","highr","hms","htmltools","htmlwidgets","httpuv","httr","jquerylib","jsonlite","knitr","labeling","later","lattice","learnr","learnrhash","lifecycle","lubridate","magrittr","markdown","MASS","Matrix","methods","mgcv","mime","modelr","munsell","nlme","nycflights13","pillar","pkgconfig","promises","purrr","R6","Rcpp","readr","readxl","renv","reprex","rlang","rmarkdown","rprojroot","rstudioapi","rvest","sass","scales","shiny","splines","stats","stringi","stringr","tibble","tidyr","tidyselect","tidyverse","tools","utf8","utils","vctrs","viridisLite","withr","xfun","xml2","xtable","yaml"]},{"type":"character","attributes":{},"value":["0.2.1","1.2.1","4.0.5","0.7.7","0.2.5.1","1.1.0","2.0.0","2.5.0","2.0-1","4.0.5","1.4.1","4.3.1","4.0.5","1.1.1","2.1.1","0.6.27","1.0.6","0.3.2","0.14","0.5.0","2.1.0","1.1.0","0.5.1","1.5.0","0.1.0","3.3.4","1.4.2","0.2.3.9001","4.0.5","4.0.5","4.0.5","0.3.0","2.4.1","0.9","1.1.0","0.5.1.1","1.5.3","1.6.1","1.4.2","0.1.4","1.7.2","1.33","0.4.2","1.2.0","0.20-44","0.10.1.9009","0.1.0.9000","1.0.0","1.7.10","2.0.1","1.1","7.3-54","1.3-3","4.0.5","1.8-35","0.10","0.1.8","0.5.0","3.1-152","1.0.2","1.6.1","2.0.3","1.2.0.1","0.3.4","2.5.0","1.0.6","1.4.0","1.3.1","0.13.2","2.0.0","0.4.11","2.9","2.0.2","0.13","1.0.0","0.4.0","1.1.1","1.6.0","4.0.5","4.0.5","1.6.2","1.4.0","3.1.2","1.1.3","1.1.1","1.3.1","4.0.5","1.2.1","4.0.5","0.3.8","0.4.0","2.4.2","0.24","1.3.2","1.8-4","2.2.1"]}]}]}
</script>
<!--/html_preserve-->
</div>
</div>

</div> <!-- topics -->

<div class="topicsContainer">
<div class="topicsPositioner">
<div class="band">
<div class="bandContent topicsListContainer">

<!-- begin doc-metadata -->
<div id="doc-metadata">
<h2 class="title toc-ignore" style="display:none;">Modelación de Datos</h2>
</div>
<!-- end doc-metadata -->

</div> <!-- bandContent.topicsListContainer -->
</div> <!-- band -->
</div> <!-- topicsPositioner -->
</div> <!-- topicsContainer -->


</div> <!-- bandContent page -->
</div> <!-- pageContent band -->



<!-- Build Tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("section-TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<script>
// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});
</script>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>


</body>

</html>
